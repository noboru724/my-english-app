<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è‹±ä½œæ–‡ç·´ç¿’ã‚¢ãƒ—ãƒª</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f6f8fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    #progress {
      text-align: center;
      font-weight: bold;
      margin-bottom: 15px;
      color: #0078d7;
    }
    #question {
      font-size: 1.2em;
      margin-bottom: 15px;
      padding: 10px;
      background: #f0f4ff;
      border-radius: 8px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
    }
    button {
      background: #0078d7;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 8px;
    }
    button:hover {
      background: #005fa3;
    }
    #result, #feedback {
      margin-top: 10px;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>è‹±ä½œæ–‡ ç·´ç¿’ã‚¢ãƒ—ãƒª</h1>
    <div id="progress">ç¬¬1å• / å…¨20å•</div>
    <div id="question">ã“ã“ã«å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
    <input type="text" id="answer" placeholder="è‹±èªã§ç­”ãˆã¦ãã ã•ã„" />
    <div>
      <button id="submit">è§£ç­”</button>
      <button id="next" style="display:none;">æ¬¡ã¸</button>
    </div>
    <div id="feedback"></div>
    <div id="result"></div>
  </div>

  <script>
    const questionsData = [
      { jp: "å½¼ãŒæ˜¨æ—¥ã©ã“ã«è¡Œã£ãŸã®ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you know where he went yesterday?" },
      { jp: "ç§ã¯å½¼å¥³ãŒã©ã‚Œãã‚‰ã„å¿™ã—ã„ã®ã‹çŸ¥ã‚Šã¾ã›ã‚“ã€‚", en: "I donâ€™t know how busy she is." },
      { jp: "å½¼ãŒä½•æ™‚ã«å®¶ã«å¸°ã‚‹ã®ã‹æ•™ãˆã¦ãã ã•ã„ã€‚", en: "Tell me what time he goes home." },
      { jp: "å½¼ã‚‰ãŒã©ã‚Œãã‚‰ã„ãã®å•é¡Œã‚’é‡è¦ã ã¨æ€ã£ã¦ã„ã‚‹ã®ã‹è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚", en: "Letâ€™s think about how important they think the issue is." },
      { jp: "ç§ã¯ã‚ãªãŸãŒæ˜¨æ—¥éŠ€è¡Œã«è¡Œã£ãŸã“ã¨ã‚’è¦šãˆã¦ã„ã¾ã™ã€‚", en: "I remember you went to the bank yesterday." },
      { jp: "ç§ã¯ä»•äº‹ã‚’çµ‚ãˆãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚", en: "I have to finish work." },
      { jp: "ç§ã¯å½¼ã«è¬ã‚‰ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", en: "I had to say sorry to him." },
      { jp: "ç§ã¯ã‚‚ã£ã¨é ‘å¼µã‚ŠãŸã„ã§ã™ã€‚", en: "I want to make more progress." },
      { jp: "ç§ã¯ä»¥å‰ã‚ˆãã‚¸ãƒ ã«è¡Œã£ã¦ã„ã¾ã—ãŸã€‚", en: "I used to go to the gym." },
      { jp: "ç§ã¯å½¼å¥³ã«ãƒ—ãƒ­ãƒãƒ¼ã‚ºã™ã‚‹ã¤ã‚‚ã‚Šã§ã—ãŸã€‚", en: "I was going to propose to her." },
      { jp: "ç§ã¯æ—©èµ·ãã™ã‚‹ã®ã«æ…£ã‚Œã¦ã„ã¾ã™ã€‚", en: "Iâ€™m used to getting up early." },
      { jp: "ç§ã¯å®¶äº‹ã‚’ã™ã‚‹ã®ãŒå«Œã„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚", en: "I donâ€™t mind doing the housework." },
      { jp: "å½¼ã«ä¼šã†ã®ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ã€‚", en: "Iâ€™m looking forward to seeing him." },
      { jp: "ç§ã¯ã‚¹ãƒˆãƒ¬ã‚¹ã‚’ç™ºæ•£ã™ã‚‹ãŸã‚ã«é‹å‹•ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¦ã„ã¾ã™ã€‚", en: "Iâ€™m thinking about working out to get rid of stress." },
      { jp: "å½¼ã¨ã‘ã‚“ã‹ã—ãŸã“ã¨ã‚’å¾Œæ‚”ã—ã¦ã„ã¾ã™ã€‚", en: "I regret having a fight with him." },
      { jp: "ç§ã¯ä¸€åº¦ã‚‚å½¼å¥³ã«ä¼šã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", en: "Iâ€™ve never met her." },
      { jp: "å½¼ã«è¬ã‚‹ã¹ãã§ã—ãŸã€‚", en: "I shouldâ€™ve said sorry to him." },
      { jp: "ç§ã¯ã‚‚ã£ã¨ãŠé‡‘ã‚’è²¯ã‚ã‚‹ã“ã¨ãŒã§ããŸã®ã«ã€‚", en: "I couldâ€™ve saved more money." },
      { jp: "å½¼ã«ãƒ—ãƒ­ãƒãƒ¼ã‚ºã™ã‚Œã°ã‚ˆã‹ã£ãŸã€‚", en: "I shouldâ€™ve proposed to him." },
      { jp: "å½¼ã«äºŒåº¦ã¨ãã‚“ãªã“ã¨ã‚’è¨€ã‚ãªã‘ã‚Œã°ã‚ˆã‹ã£ãŸã€‚", en: "I shouldnâ€™t have said that to him again." }
    ];

    let usedIndexes = [];
    let currentIndex = 0;
    let answersLog = [];
    let currentQuestionNumber = 0;

    const progressEl = document.getElementById('progress');
    const questionEl = document.getElementById('question');
    const answerEl = document.getElementById('answer');
    const feedbackEl = document.getElementById('feedback');
    const resultEl = document.getElementById('result');
    const submitBtn = document.getElementById('submit');
    const nextBtn = document.getElementById('next');

    function getRandomQuestion() {
      if (usedIndexes.length >= 20) return null;
      let index;
      do {
        index = Math.floor(Math.random() * questionsData.length);
      } while (usedIndexes.includes(index));
      usedIndexes.push(index);
      return questionsData[index];
    }

    function showQuestion() {
      const q = getRandomQuestion();
      if (!q) {
        endQuiz();
        return;
      }
      currentIndex = questionsData.indexOf(q);
      currentQuestionNumber = usedIndexes.length;
      progressEl.textContent = `ç¬¬${currentQuestionNumber}å• / å…¨20å•`;
      questionEl.textContent = q.jp;
      feedbackEl.textContent = '';
      answerEl.value = '';
      answerEl.style.display = 'block';
      submitBtn.style.display = 'inline-block';
      nextBtn.style.display = 'none';
    }


    const synonyms = {
  // ğŸ”¹å‹•è©ï¼ˆVerbï¼‰
  "buy": ["get", "purchase", "pick up"],
  "get": ["buy", "obtain", "receive"],
  "say": ["tell", "mention"],
  "tell": ["say", "inform"],
  "speak": ["talk", "chat"],
  "talk": ["speak", "chat"],
  "begin": ["start"],
  "start": ["begin"],
  "make": ["create", "build", "cook", "prepare"],
  "cook": ["make", "prepare"],
  "eat": ["have"],
  "drink": ["have"],
  "see": ["watch", "look at"],
  "watch": ["see", "look at"],
  "look for": ["search for", "try to find"],
  "find": ["discover"],
  "help": ["assist", "support", "give a hand"],
  "fix": ["repair", "mend"],
  "go": ["travel", "move"],
  "come": ["arrive"],
  "leave": ["go out", "depart"],
  "meet": ["see", "get together with"],
  "live": ["stay", "reside"],
  "need": ["require"],
  "want": ["would like", "hope to"],
  "think": ["believe", "guess", "suppose"],
  "wait": ["hang on", "hold on"],
  "try": ["attempt"],
  "use": ["utilize"],
  "show": ["display"],
  "finish": ["end", "complete"],
  "understand": ["get", "figure out"],
  "ask": ["request", "inquire"],
  "learn": ["study", "pick up"],
  "teach": ["instruct"],
  "remember": ["recall"],
  "forget": ["miss", "fail to remember"],
  "give": ["hand", "offer", "pass"],
  "take": ["grab", "carry"],
  "like": ["enjoy", "love"],
  "love": ["like", "enjoy"],
  "hate": ["dislike", "canâ€™t stand"],
  "work": ["labor", "do a job"],
  "rest": ["relax", "take a break"],
  "walk": ["go on foot", "stroll"],
  "run": ["jog"],
  "open": ["unlock"],
  "close": ["shut"],
  "say sorry": ["apologize"],

  // ğŸ”¹åè©ï¼ˆNounï¼‰
  "children": ["kids"],
  "child": ["kid"],
  "friend": ["buddy", "pal", "mate"],
  "job": ["work", "occupation"],
  "house": ["home", "residence"],
  "car": ["vehicle", "ride"],
  "clothes": ["outfit", "garment"],
  "money": ["cash"],
  "picture": ["photo", "image"],
  "question": ["inquiry"],
  "answer": ["reply", "response"],
  "food": ["meal", "dish"],
  "movie": ["film"],
  "store": ["shop"],
  "teacher": ["instructor"],
  "student": ["learner"],
  "street": ["road"],
  "school": ["academy"],
  "book": ["novel", "volume"],

  // ğŸ”¹å½¢å®¹è©ï¼ˆAdjectiveï¼‰
  "happy": ["glad", "pleased"],
  "sad": ["unhappy", "upset"],
  "angry": ["mad"],
  "beautiful": ["pretty", "lovely", "gorgeous"],
  "difficult": ["hard"],
  "easy": ["simple"],
  "fast": ["quick"],
  "slow": ["sluggish"],
  "tired": ["sleepy", "exhausted"],
  "hungry": ["starving"],
  "full": ["stuffed"],
  "good": ["nice", "great", "fine"],
  "bad": ["terrible", "awful"],
  "okay": ["fine", "alright"],
  "big": ["large", "huge"],
  "small": ["little", "tiny"],
  "rich": ["wealthy"],
  "poor": ["needy"],
  "busy": ["occupied"],
  "funny": ["amusing", "hilarious"],
  "interesting": ["fascinating"],
  "important": ["significant", "crucial"],
  "smart": ["clever", "intelligent"],
  "beautiful": ["pretty", "lovely", "cute"],
  "cold": ["chilly", "cool"],
  "hot": ["warm", "boiling"],
  "scary": ["frightening", "creepy"],
  "friendly": ["kind", "nice"],
  "expensive": ["costly", "pricey"],
  "cheap": ["inexpensive"],

  // ğŸ”¹å‰¯è©ãƒ»è¡¨ç¾ï¼ˆAdverb / Phrasesï¼‰
  "maybe": ["perhaps", "possibly"],
  "really": ["very", "truly"],
  "a lot": ["lots", "plenty"],
  "right now": ["currently", "at the moment"],
  "later": ["afterwards", "soon"],
  "sometimes": ["occasionally"],
  "always": ["all the time"],
  "never": ["not ever"],
  "very good": ["great", "awesome"],
  "very bad": ["terrible", "awful"],
  "thank you": ["thanks", "appreciate it"],
  "goodbye": ["bye", "see you"],
  "hello": ["hi", "hey"]
};


  function checkAnswer() {
  const userAnswer = answerEl.value.trim();
  const correctAnswer = questionsData[currentIndex].en;

  // ğŸ”½ å‰å‡¦ç†ï¼ˆå°æ–‡å­—åŒ–ï¼‹ç¸®ç´„å½¢çµ±ä¸€ï¼‰
  const normalize = str =>
    str
      .toLowerCase()
      .replace(/â€™/g, "'")
      // notç³»
      .replace(/\bshouldn['â€™]t\b/g, "should not")
      .replace(/\bcouldn['â€™]t\b/g, "could not")
      .replace(/\bwouldn['â€™]t\b/g, "would not")
      .replace(/\bdon['â€™]t\b/g, "do not")
      .replace(/\bdoesn['â€™]t\b/g, "does not")
      .replace(/\bdidn['â€™]t\b/g, "did not")
      // haveç³»ï¼ˆ'veï¼‰
      .replace(/\bshould['â€™]ve\b/g, "should have")
      .replace(/\bcould['â€™]ve\b/g, "could have")
      .replace(/\bwould['â€™]ve\b/g, "would have")
      .replace(/\bi['â€™]ve\b/g, "i have")
      .replace(/\byou['â€™]ve\b/g, "you have")
      .replace(/\bthey['â€™]ve\b/g, "they have")
      .replace(/\bwe['â€™]ve\b/g, "we have")
      .trim()
      .replace(/\s+/g, " "); // ä½™åˆ†ãªç©ºç™½ã‚’çµ±ä¸€

  const normalizedUser = normalize(userAnswer);
  const normalizedCorrect = normalize(correctAnswer);

  // ğŸš« æ˜ç¢ºãªæ–‡æ³•ãƒŸã‚¹ï¼ˆto there, to home ãªã©ï¼‰
  const grammarErrors = [/to there\b/, /to home\b/, /to abroad\b/, /to outside\b/];
  const hasGrammarError = grammarErrors.some(re => re.test(normalizedUser));

  // ğŸ§  å˜èªãƒ¬ãƒ™ãƒ«ã§æ„å‘³ã®ä¸€è‡´ã‚’ãƒã‚§ãƒƒã‚¯
  const userWords = normalizedUser.split(" ");
  const correctWords = normalizedCorrect.split(" ");

  // åŒç¾©èªè¾æ›¸ï¼ˆå¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µå¯èƒ½ï¼‰
  const synonyms = {
    "children": ["kids"],
    "buy": ["purchase", "get"],
    "begin": ["start"],
    "want": ["would like"],
    "help": ["assist"],
    "ask": ["request"]
  };

  // åŒç¾©èªã‚’è€ƒæ…®ã—ã¦ãƒãƒƒãƒåˆ¤å®š
  const matchedCount = correctWords.filter(correctWord => {
    return userWords.some(userWord => {
      if (userWord === correctWord) return true;
      const syns = synonyms[correctWord];
      return syns ? syns.includes(userWord) : false;
    });
  }).length;

  const similarity = matchedCount / correctWords.length;

  // âœ… æ„å‘³ã¨æ–‡æ³•ã®ä¸¡æ–¹ãŒåˆã£ã¦ã„ã‚Œã°æ­£è§£
  const isCorrect =
    !hasGrammarError &&
    (normalizedUser === normalizedCorrect || similarity >= 0.8);

  if (isCorrect) {
    feedbackEl.innerHTML = `âœ… æ­£è§£ã§ã™ï¼<br>æ¨¡ç¯„è§£ç­”ï¼š<span style="color:#0078d7;">${correctAnswer}</span>`;
    feedbackEl.style.color = "green";
  } else {
    feedbackEl.innerHTML = `âŒ ä¸æ­£è§£ã§ã™ã€‚<br>ã‚ãªãŸã®å›ç­”ï¼š<span style="color:#555;">${userAnswer}</span><br>æ¨¡ç¯„è§£ç­”ï¼š<span style="color:#d32f2f;">${correctAnswer}</span>`;
    feedbackEl.style.color = "red";
  }

  answersLog.push({
    jp: questionsData[currentIndex].jp,
    user: userAnswer,
    correct: correctAnswer,
    result: isCorrect ? "æ­£è§£" : "ä¸æ­£è§£"
  });

  submitBtn.style.display = "none";
  nextBtn.style.display = "inline-block";
}



   

    function endQuiz() {
      questionEl.textContent = 'ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼å…¨20å•ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚';
      progressEl.textContent = '';
      answerEl.style.display = 'none';
      submitBtn.style.display = 'none';
      nextBtn.style.display = 'none';
      feedbackEl.textContent = '';

      let tableHTML = '<table><tr><th>å‡ºé¡Œæ–‡ï¼ˆæ—¥æœ¬èªï¼‰</th><th>ã‚ãªãŸã®è§£ç­”</th><th>æ­£è§£è‹±æ–‡</th></tr>';
      answersLog.forEach(a => {
        tableHTML += `<tr><td>${a.jp}</td><td>${a.user}</td><td>${a.correct}</td></tr>`;
      });
      tableHTML += '</table>';
      resultEl.innerHTML = tableHTML;
    }

    submitBtn.addEventListener('click', checkAnswer);
    nextBtn.addEventListener('click', () => {
      if (usedIndexes.length >= 20) {
        endQuiz();
      } else {
        showQuestion();
      }
    });

    showQuestion();
  </script>
</body>
</html>
