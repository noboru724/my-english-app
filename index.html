<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>è‹±ä½œæ–‡ ç·´ç¿’ã‚¢ãƒ—ãƒª  â€” 9ã‚¿ã‚¤ãƒ— Ã— 30å•ï¼ˆ270å•ï¼‰</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  /* æ·¡ã„ãƒ–ãƒ«ãƒ¼ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ + æŸ”ã‚‰ã‹ã„ãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ */
  :root{
    --bg1: #e6f2ff;
    --bg2: #f3f9ff;
    --card: #ffffff;
    --primary: #2563eb;
    --accent: #10b981;
    --warn: #f59e0b;
    --muted: #6b7280;
  }
  html,body{height:100%}
  body{
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
    margin:0;padding:18px;display:flex;justify-content:center;align-items:flex-start;
    background: linear-gradient(180deg,var(--bg1) 0%, #f7fbff 40%, var(--bg2) 100%);
    -webkit-font-smoothing:antialiased;
  }
  .wrap{width:100%;max-width:980px}
  h1{margin:6px 0 12px;color:#0f172a;font: size 42px;font-weight:700}
  .top{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
  select,input[type=checkbox],input[type=text]{
    padding:8px;border-radius:10px;border:1px solid #dbeafe;background:#fff;
    box-shadow: 0 1px 0 rgba(2,6,23,0.03);
  }
  .card{
    background:var(--card);
    padding:18px;border-radius:14px;
    box-shadow: 0 10px 30px rgba(2,6,23,0.06);
    border: 1px solid rgba(15,23,42,0.03);
  }
  #questionJP{font-size:22px;margin-bottom:8px;color:#0b1220}
  .muted.small{color:var(--muted);font-size:13px}
  textarea{width:98%;min-height:84px;padding:12px;border-radius:10px;border:1px solid #e6eefc;font-size:22px;background:#fbfdff}
  .btns{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  button{
    background:var(--primary);color:#fff;border:none;padding:10px 14px;border-radius:12px;cursor:pointer;font-size:15px;
    box-shadow: 0 6px 18px rgba(37,99,235,0.12);transition:transform .08s ease, box-shadow .08s ease;
  }
  button.secondary{background:var(--accent); box-shadow: 0 6px 18px rgba(16,185,129,0.12)}
  button.warn{background:var(--warn); box-shadow: 0 6px 18px rgba(245,158,11,0.12)}
  button.ghost{background:transparent;color:var(--primary);border:1px solid rgba(37,99,235,0.12);box-shadow:none}
  button:active{transform:translateY(1px)}
  .feedback{margin-top:12px;min-height:44px;font-weight:700;font-size:16px}
  .exampleEN{margin-top:8px;color:#0b1220;font-weight:600}
  .scoreboard{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  .scorebox{background:#f8fafc;padding:10px;border-radius:10px;border:1px solid #e6eefc;min-width:160px}
  .small{font-size:13px;color:var(--muted)}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
  .right{margin-left:auto}
  footer{margin-top:16px;font-size:13px;color:var(--muted)}
  .muted{color:var(--muted);font-size:13px}
  @media(max-width:640px){
    .top{flex-direction:column;align-items:stretch}
    .btns{flex-direction:column}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>è‹±ä½œæ–‡ ç·´ç¿’ã‚¢ãƒ—ãƒª  â€” 9ã‚¿ã‚¤ãƒ— Ã— 30å•ï¼ˆ270å•ï¼‰</h1>

  <div class="top">
    <label>ã‚¿ã‚¤ãƒ—ï¼š
      <select id="typeSelect"></select>
    </label>

    <label>ãƒ¢ãƒ¼ãƒ‰ï¼š
      <select id="modeSelect">
        <option value="seq">é †ç•ª</option>
        <option value="shuffle">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</option>
      </select>
    </label>

    <label>éŸ³å£°è¨€èªï¼š
      <select id="ttsLang">
        <option value="en-US">English (en-US)</option>
        <option value="ja-JP">æ—¥æœ¬èª (ja-JP)</option>
      </select>
    </label>

    <label class="right small">æ¤œç´¢ï¼š
      <input id="searchInput" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ (ä¾‹: dinner)" />
    </label>
  </div>

  <div class="card">
    <div id="questionJP">ã“ã“ã«æ—¥æœ¬èªã®å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
    <div class="muted small" id="metaInfo"></div>
    <textarea id="answer" placeholder="ã“ã“ã«è‹±èªã§å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>

    <div class="btns">
      <button id="checkBtn">ç­”ãˆåˆã‚ã›</button>
      <button id="nextBtn" class="secondary">â–¶ æ¬¡ã®å•é¡Œã¸</button>
      <button id="speakBtn" class="warn">ğŸ”Š èª­ã‚€</button>
      <button id="speakBothBtn" class="ghost">ğŸ”Š è‹±â†’æ—¥</button>
      <button id="voiceBtn" class="">ğŸ¤ éŸ³å£°å…¥åŠ›</button>
      <button id="showAllBtn" class="ghost">ğŸ“š å…¨å•è¡¨ç¤º</button>
      <button id="resetScoreBtn" style="background:#ef4444;box-shadow:0 6px 18px rgba(239,68,68,0.12)">ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="feedback" id="feedback"></div>
    <div class="exampleEN" id="exampleEN" aria-live="polite"></div>

    <div class="scoreboard" id="scoreboard"></div>

    <div style="margin-top:10px">
      <label><input type="checkbox" id="acceptPartial" checked /> éƒ¨åˆ†ä¸€è‡´ï¼ˆæŸ”è»Ÿåˆ¤å®šï¼‰ã‚’è¨±å¯</label>
    </div>
  </div>

  <div id="allList" style="margin-top:12px;display:none"></div>

  <footer>
    æ³¨ï¼šåˆ¤å®šã¯çŸ­ç¸®å½¢ãƒ»åŒç¾©èªãƒ»é¡ä¼¼è¡¨ç¾ã‚’è¨±å®¹ã—ã¦ã„ã¾ã™ã€‚éŸ³å£°èªè­˜ã¯ãƒ–ãƒ©ã‚¦ã‚¶ä¾å­˜ï¼ˆChromeæ¨å¥¨ï¼‰ã€‚
  </footer>
</div>

<script>
/* ===========================
   å…ƒã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¶­æŒã—ã¤ã¤ã€ä»¥ä¸‹ã‚’å®Ÿè£…ï¼š
   - æ­£è§£æ™‚ã«ã‚‚æ¨¡ç¯„è§£ç­”ï¼ˆè‹±ï¼‰ã‚’è¡¨ç¤ºï¼ˆexampleENï¼‰
   - è‡ªå‹•ä¿å­˜ï¼†å¾©å…ƒï¼ˆã‚¿ã‚¤ãƒ—ãƒ»indexãƒ»modeãƒ»scoresãƒ»shuffled orderï¼‰
   - å¤–è¦³ã¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼†æŸ”ã‚‰ã‹ãƒœã‚¿ãƒ³ï¼ˆCSSä¸Šã§å®Ÿç¾æ¸ˆã¿ï¼‰
   ===========================*/

const TYPE_LABELS = [
  "WHåè©ç¯€","å‹•åè©","ä¸å®šè©","éå»åˆ†è©","å‹•è©ã®åŸå½¢","æœªæ¥å½¢","ä»®å®šæ³•","å—å‹•æ…‹","ç¾åœ¨å®Œäº†"
];

/* --- 9ã‚¿ã‚¤ãƒ— Ã— 30å• = 270å•ï¼ˆæ—¢ã«ç”¨æ„ã•ã‚ŒãŸå•é¡Œã‚’ã“ã“ã«ãƒ•ãƒ«ã§æŒ¿å…¥ï¼‰ --- */
/* ï¼ˆå‰ã‚³ãƒ¼ãƒ‰ã¨åŒã˜å•é¡Œç¾¤ã‚’ä½¿ç”¨ï¼‰ */
const q0 = [
  { jp: "å½¼ãŒã„ã¤å¸°ã£ã¦ãã‚‹ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you know when he will come back?" },
  { jp: "ãªãœå½¼å¥³ãŒæ€’ã£ã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚", en: "I donâ€™t know why she is angry." },
  { jp: "å½¼ãŒã©ã“ã§åƒã„ã¦ã„ã‚‹ã‹è¦šãˆã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you remember where he works?" },
  { jp: "å½¼ãŒãã®ä»•äº‹ã‚’å—ã‘ã‚‹ã‹ã©ã†ã‹æ•™ãˆã¦ãã ã•ã„ã€‚", en: "Tell me if he will take the job." },
  { jp: "å½¼å¥³ãŒä½•ã‚’è€ƒãˆã¦ã„ã‚‹ã®ã‹çŸ¥ã‚ŠãŸã„ã€‚", en: "I want to know what she is thinking." },
  { jp: "å½¼ãŒã©ã‚Œãã‚‰ã„ç–²ã‚Œã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã‚Šã¾ã™ã‹ï¼Ÿ", en: "Do you know how tired he is?" },
  { jp: "ãªãœå½¼å¥³ãŒä¼šè­°ã«æ¥ãªã‹ã£ãŸã®ã‹è¦šãˆã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you remember why she didnâ€™t come to the meeting?" },
  { jp: "å½¼ãŒä½•ã‚’æ³¨æ–‡ã—ãŸã‹æ€ã„å‡ºã›ã¾ã›ã‚“ã€‚", en: "I donâ€™t remember what he ordered." },
  { jp: "å½¼å¥³ãŒã©ã‚“ãªäººãªã®ã‹æ•™ãˆã¦ãã ã•ã„ã€‚", en: "Tell me what kind of person she is." },
  { jp: "å½¼ãŒã©ã“ã«è¡Œã£ãŸã®ã‹åˆ†ã‹ã‚Šã¾ã—ãŸã€‚", en: "I found out where he went." },
  { jp: "å½¼å¥³ãŒå¥åº·ã‹ã©ã†ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you know if she is healthy?" },
  { jp: "ãªãœå½¼ãŒãã‚“ãªã“ã¨ã‚’è¨€ã£ãŸã®ã‹åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚", en: "I donâ€™t know why he said that." },
  { jp: "å½¼ãŒã„ã¤ä¼šç¤¾ã‚’è¾ã‚ãŸã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you know when he quit the company?" },
  { jp: "å½¼ãŒãã®å•é¡Œã‚’ã©ã†è§£æ±ºã—ãŸã‹èãã¾ã—ãŸã‹ï¼Ÿ", en: "Did you hear how he solved the problem?" },
  { jp: "å½¼ãŒèª°ã¨ãƒ‡ãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‹åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚", en: "I donâ€™t know who he is dating." },
  { jp: "å½¼ãŒç§ã«ä½•ã‚’è¨€ã„ãŸã‹ã£ãŸã®ã‹åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚", en: "I donâ€™t know what he wanted to tell me." },
  { jp: "å½¼å¥³ãŒã©ã®ç—…é™¢ã«è¡Œã£ãŸã®ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you know which hospital she went to?" },
  { jp: "å½¼ãŒãã®ä»•äº‹ã‚’æ–­ã£ãŸç†ç”±ã‚’çŸ¥ã‚ŠãŸã„ã€‚", en: "I want to know why he turned down the job." },
  { jp: "å½¼å¥³ãŒèª°ã¨è©±ã—ã¦ã„ãŸã®ã‹æ°—ã«ãªã‚Šã¾ã™ã€‚", en: "I wonder who she was talking to." },
  { jp: "å½¼ãŒä»Šæ—¥æ¥ã‚‹ã‹ã©ã†ã‹åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚", en: "I donâ€™t know if he will come today." },
  { jp: "å½¼å¥³ãŒã©ã®æœã‚’é¸ã¶ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚", en: "Letâ€™s see which dress she will choose." },
  { jp: "å½¼ãŒä»Šä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹æ•™ãˆã¦ãã ã•ã„ã€‚", en: "Tell me what he is doing now." },
  { jp: "å½¼ãŒã©ã‚Œãã‚‰ã„å¿™ã—ã„ã®ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you know how busy he is?" },
  { jp: "ãªãœå½¼å¥³ãŒãã‚“ãªã«å¹¸ã›ãªã®ã‹ä¸æ€è­°ã§ã™ã€‚", en: "I wonder why she is so happy." },
  { jp: "å½¼ãŒé€±æœ«ã«ã©ã“ã¸è¡Œãã®ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you know where he is going this weekend?" },
  { jp: "å½¼å¥³ãŒä½•æ™‚ã«èµ·ããŸã®ã‹è¦šãˆã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you remember what time she woke up?" },
  { jp: "å½¼ãŒãã‚Œã‚’ã©ã†ã‚„ã£ã¦ä¿®ç†ã—ãŸã®ã‹çŸ¥ã‚ŠãŸã„ã€‚", en: "I want to know how he fixed it." },
  { jp: "å½¼å¥³ãŒãªãœãã®ä»•äº‹ã‚’é¸ã‚“ã ã®ã‹æ•™ãˆã¦ãã ã•ã„ã€‚", en: "Tell me why she chose that job." },
  { jp: "å½¼ãŒãã®æ˜ ç”»ã‚’å¥½ãã‹ã©ã†ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en: "Do you know if he likes the movie?" },
  { jp: "å½¼å¥³ãŒä½•ã‚’æ¬²ã—ãŒã£ã¦ã„ã‚‹ã®ã‹è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚", en: "Letâ€™s think about what she wants." }
];

const q1 = [
  { jp: "ç§ã¯æœæ—©ãèµ·ãã‚‹ã®ã«æ…£ã‚Œã¦ã„ã¾ã™ã€‚", en: "Iâ€™m used to getting up early." },
  { jp: "å½¼ã¯å¿™ã—ãã—ã¦ã„ã‚‹ã®ã«æ…£ã‚Œã¦ã„ã¾ã™ã€‚", en: "Heâ€™s used to being busy." },
  { jp: "ç§ã¯å½¼å¥³ã«ä¼šãˆãªã„ã“ã¨ã«ã†ã‚“ã–ã‚Šã—ã¦ã„ã¾ã™ã€‚", en: "Iâ€™m sick of not seeing her." },
  { jp: "å½¼å¥³ã¯é…ãã¾ã§åƒãã®ã«ç–²ã‚Œã¦ã„ã¾ã™ã€‚", en: "Sheâ€™s tired of working late." },
  { jp: "ç§ã¯é‹å‹•ã™ã‚‹ã®ã‚’é¿ã‘ã¦ã„ã¾ã›ã‚“ã€‚", en: "I donâ€™t mind exercising." },
  { jp: "å½¼ã¯å½¼å¥³ã®ç¬‘é¡”ã‚’è¦‹ã‚‹ã®ã‚’æ‹ã—ãæ€ã£ã¦ã„ã¾ã™ã€‚", en: "He misses seeing her smile." },
  { jp: "ç§ã¯æ—…è¡Œã«è¡Œãã®ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ã€‚", en: "Iâ€™m looking forward to going on a trip." },
  { jp: "å½¼å¥³ã¯ä½•ã‚‚ã›ãšã«ã„ã‚‹è‡ªåˆ†ã‚’æƒ³åƒã§ãã¾ã›ã‚“ã€‚", en: "She canâ€™t imagine being lazy." },
  { jp: "ç§ã¯æ˜¨æ—¥æ—©ãå¯ãŸã“ã¨ã‚’å¾Œæ‚”ã—ã¦ã„ã¾ã™ã€‚", en: "I regret going to bed early yesterday." },
  { jp: "å½¼ã¯è‹±èªã‚’å‹‰å¼·ã™ã‚‹ã®ãŒå¥½ãã§ã™ã€‚", en: "He likes studying English." },
  { jp: "ç§ã¯äººå‰ã§è©±ã™ã®ãŒè‹¦æ‰‹ã§ã™ã€‚", en: "I canâ€™t stand speaking in public." },
  { jp: "å½¼å¥³ã¯ãã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦è€ƒãˆã¦ã„ã¾ã™ã€‚", en: "Sheâ€™s thinking about working on that project." },
  { jp: "ç§ã®æ‰‹ä¼ã„ã‚’ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€‚", en: "Thank you for helping me." },
  { jp: "å½¼ã¯ã‚¸ãƒ ã«è¡Œãã®ã‚’ã‚„ã‚ãŸã®ã§ã™ã‹ï¼Ÿ", en: "What happened to going to the gym?" },
  { jp: "ç§ã¯å¥åº·çš„ã§ã„ã‚‹ã“ã¨ã«æ…£ã‚Œã¦ã„ã¾ã™ã€‚", en: "Iâ€™m used to being healthy." },
  { jp: "å½¼ã¯å½¼å¥³ã«ç„¡è¦–ã•ã‚Œã‚‹ã®ã«ã†ã‚“ã–ã‚Šã—ã¦ã„ã¾ã™ã€‚", en: "Heâ€™s sick of being ignored by her." },
  { jp: "ç§ã¯å½¼ãŒåŠªåŠ›ã—ãªã„ã“ã¨ã«ã†ã‚“ã–ã‚Šã—ã¦ã„ã¾ã™ã€‚", en: "Iâ€™m sick of him not trying." },
  { jp: "å½¼å¥³ã¯è‡ªåˆ†ãŒå¼·ããªã£ã¦ã„ãã“ã¨ã‚’æ¥½ã—ã‚“ã§ã„ã¾ã™ã€‚", en: "She enjoys becoming stronger." },
  { jp: "ç§ã¯æ–°ã—ã„äººã¨å‡ºä¼šã†ã®ãŒå¥½ãã§ã™ã€‚", en: "I like meeting new people." },
  { jp: "å½¼ã¯ãƒãƒ¼ãƒ ã®ä¸€å“¡ã§ã‚ã‚‹ã“ã¨ã«æ…£ã‚Œã¦ã„ã¾ã™ã€‚", en: "Heâ€™s used to being part of a team." },
  { jp: "ç§ã¯å½¼å¥³ãŒé…åˆ»ã™ã‚‹ã®ã«æˆ‘æ…¢ã§ãã¾ã›ã‚“ã€‚", en: "I canâ€™t stand her being late." },
  { jp: "å½¼å¥³ã¯å¥åº·çš„ãªé£Ÿäº‹ã‚’ä½œã‚‹ã®ãŒå¥½ãã§ã™ã€‚", en: "She likes making healthy meals." },
  { jp: "ç§ã¯å¤œæ›´ã‹ã—ã—ãªã„ã“ã¨ã«æ…£ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", en: "Iâ€™m not used to not staying up late." },
  { jp: "å½¼ã¯æ€’ã‚‰ã‚Œãªã„ã‚ˆã†ã«è¡Œå‹•ã—ã¦ã„ã¾ã™ã€‚", en: "Heâ€™s thinking about not making mistakes." },
  { jp: "å½¼å¥³ã¯å„ªã—ãã•ã‚Œã‚‹ã®ã«æ…£ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", en: "She isnâ€™t used to being treated kindly." },
  { jp: "ç§ã¯å½¼ãŒé ‘å¼µã‚‹ã®ã‚’è¦‹ã‚‹ã®ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ã€‚", en: "Iâ€™m looking forward to seeing him do his best." },
  { jp: "å½¼ã¯éƒ¨å±‹ã‚’ç‰‡ä»˜ã‘ã¦ãã‚ŒãŸã“ã¨ã«æ„Ÿè¬ã—ã¦ã„ã¾ã™ã€‚", en: "Heâ€™s thankful for her cleaning the room." },
  { jp: "ç§ã¯ä½•ã‚‚ã›ãšã«ã„ã‚‹ã®ãŒå«Œã„ã§ã™ã€‚", en: "I hate doing nothing." },
  { jp: "å½¼å¥³ã¯æ¯æœãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã™ã‚‹ã“ã¨ã«æ…£ã‚Œã¦ã„ã¾ã™ã€‚", en: "Sheâ€™s used to running every morning." },
  { jp: "ç§ã¯è‡ªåˆ†ãŒæ€ ã‘ã¦ã„ãªã„ã“ã¨ã‚’èª‡ã‚Šã«æ€ã£ã¦ã„ã¾ã™ã€‚", en: "Iâ€™m proud of not being lazy." }
];

const q2 = [
  {jp:"ç§ã¯è‹±èªã‚’å­¦ã³ãŸã„ã§ã™ã€‚", en:"I want to learn English."},
  {jp:"å½¼å¥³ã¯æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã†ã‚ˆã†é ¼ã¿ã¾ã—ãŸã€‚", en:"She asked me to help her."},
  {jp:"å½¼ã¯æ¥ã‚‹ã“ã¨ã‚’æ±ºã‚ã¾ã—ãŸã€‚", en:"He decided to come."},
  {jp:"ç§ã¯æœ¬ã‚’èª­ã‚€ãŸã‚ã«å›³æ›¸é¤¨ã«è¡Œãã¾ã™ã€‚", en:"I go to the library to read books."},
  {jp:"å½¼ã¯åŒ»è€…ã«ãªã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚", en:"He plans to become a doctor."},
  {jp:"å½¼å¥³ã¯ç¶ºéº—ã«æ­Œã†ãŸã‚ã«ç·´ç¿’ã—ã¾ã™ã€‚", en:"She practices to sing well."},
  {jp:"ç§ã¯å½¼ã«é›»è©±ã‚’ã‹ã‘ã‚ˆã†ã¨ã—ã¾ã—ãŸã€‚", en:"I tried to call him."},
  {jp:"å½¼ã‚‰ã¯æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚‹ã“ã¨ã«åŒæ„ã—ãŸã€‚", en:"They agreed to start a new project."},
  {jp:"ç§ã¯ãƒ”ã‚¶ã‚’ä½œã‚‹ãŸã‚ã«ææ–™ã‚’è²·ã£ãŸã€‚", en:"I bought ingredients to make pizza."},
  {jp:"å½¼å¥³ã¯å½¼ã«ä¼šã†ã“ã¨ã‚’æœ›ã‚“ã§ã„ã‚‹ã€‚", en:"She hopes to meet him."},
  {jp:"çˆ¶ã¯ç§ã‚’å¤§å­¦ã«è¡Œã‹ã›ã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚", en:"My father intends to send me to college."},
  {jp:"ç§ã¯å®¿é¡Œã‚’çµ‚ã‚ã‚‰ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", en:"I need to finish my homework."},
  {jp:"å½¼ã¯ã‚ã®å ´æ‰€ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚", en:"He couldn't find the place."},
  {jp:"å½¼å¥³ã¯ã‚¹ãƒ”ãƒ¼ãƒã‚’ã™ã‚‹ã“ã¨ã‚’æã‚Œã¦ã„ã‚‹ã€‚", en:"She is afraid to give a speech."},
  {jp:"ç§ã¯çŠ¬ã‚’é£¼ã†ã“ã¨ã‚’æ±ºã‚ãŸã€‚", en:"I decided to have a dog."},
  {jp:"å½¼ã¯å•é¡Œã‚’è§£æ±ºã™ã‚‹ã“ã¨ã‚’ç´„æŸã—ãŸã€‚", en:"He promised to solve the problem."},
  {jp:"ç§ã¯ã‚ãªãŸã«çœŸå®Ÿã‚’è©±ã™ã¤ã‚‚ã‚Šã§ã™ã€‚", en:"I am going to tell you the truth."},
  {jp:"å½¼å¥³ã¯æ–™ç†ã‚’ç¿’ã†ã“ã¨ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã€‚", en:"She is interested to learn cooking."},
  {jp:"ç§ãŸã¡ã¯ã‚‚ã£ã¨ç·´ç¿’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", en:"We need to practice more."},
  {jp:"å½¼ã¯è‡ªåˆ†ã®å¤¢ã‚’è¿½ã†ã“ã¨ã«æ±ºã‚ãŸã€‚", en:"He chose to follow his dream."},
  {jp:"ç§ã¯å½¼ã‚’æ‰‹ä¼ã†ãŸã‚ã«æ¥ã¾ã—ãŸã€‚", en:"I came to help him."},
  {jp:"å½¼å¥³ã¯æ—…è¡Œã™ã‚‹ãŸã‚ã«ãŠé‡‘ã‚’è²¯ã‚ã¦ã„ã¾ã™ã€‚", en:"She is saving money to travel."},
  {jp:"å½¼ã¯æ˜æ—¥ãã®ä»•äº‹ã‚’å§‹ã‚ã‚‹äºˆå®šã§ã™ã€‚", en:"He is scheduled to start the job tomorrow."},
  {jp:"ç§ã¯ã‚ãªãŸã«ä¼ãˆã‚‹ãŸã‚ã«æˆ»ã£ã¦ãã¾ã—ãŸã€‚", en:"I came back to tell you."},
  {jp:"å½¼ã‚‰ã¯ãã®ãƒ«ãƒ¼ãƒ«ã‚’å­¦ã¶å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", en:"They need to learn the rules."},
  {jp:"ç§ã¯æ­Œã†ã“ã¨ã‚’å­¦ã³ãŸã„ã€‚", en:"I want to learn to sing."},
  {jp:"å½¼å¥³ã¯è©¦é¨“ã«åˆæ ¼ã™ã‚‹ãŸã‚ã«å‹‰å¼·ã—ã¦ã„ã‚‹ã€‚", en:"She studies to pass the exam."},
  {jp:"å½¼ã¯ä»•äº‹ã‚’è¾ã‚ã‚‹ã“ã¨ã‚’æ±ºã‚ãŸã€‚", en:"He decided to quit his job."},
  {jp:"ç§ã¯å½¼ã‚’åŠ©ã‘ã‚‹ãŸã‚ã«ã“ã“ã«ã„ã¾ã™ã€‚", en:"I am here to help him."},
  {jp:"å½¼ã¯æ–°ã—ã„è¨€èªã‚’å­¦ã³ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚", en:"He wants to learn a new language."}
];

const q3 = [
  { jp: "ç§ã¯ã‚‚ã†ãã®æ˜ ç”»ã‚’3å›è¦‹ã¾ã—ãŸã€‚", en: "Iâ€™ve seen that movie three times already." },
{ jp: "å½¼ã¯ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é•·ã„é–“å–ã‚Šçµ„ã‚“ã§ãã¾ã—ãŸã€‚", en: "Heâ€™s worked on this project for a long time." },
{ jp: "ç§ã¯ã“ã‚“ãªã«ç¾ã—ã„æ™¯è‰²ã‚’è¦‹ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", en: "Iâ€™ve never seen such a beautiful view." },
{ jp: "å½¼å¥³ã¯ä¸€åº¦ã‚‚å¤–å›½ã«è¡Œã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", en: "Sheâ€™s never been abroad." },
{ jp: "ç§ã¯ãã®ãƒ¡ãƒ¼ãƒ«ã‚’ã‚‚ã†é€ã‚Šã¾ã—ãŸã€‚", en: "Iâ€™ve already sent the email." },
{ jp: "å½¼ã‚‰ã¯ã¾ã åˆ°ç€ã—ã¦ã„ã¾ã›ã‚“ã€‚", en: "They havenâ€™t arrived yet." },
{ jp: "ç§ã¯ã‚‚ã£ã¨æ—©ãå¯ã‚‹ã¹ãã ã£ãŸã€‚", en: "I shouldâ€™ve gone to bed earlier." },
{ jp: "å½¼ã«ã‚‚ã†å°‘ã—è¦ªåˆ‡ã«ã™ã‚Œã°ã‚ˆã‹ã£ãŸã€‚", en: "I shouldâ€™ve been nicer to him." },
{ jp: "ãã‚“ãªã“ã¨ã‚’è¨€ã†ã¹ãã˜ã‚ƒãªã‹ã£ãŸã€‚", en: "I shouldnâ€™t have said that." },
{ jp: "ã‚‚ã£ã¨æ³¨æ„ã—ã¦é‹è»¢ã™ã‚Œã°ã‚ˆã‹ã£ãŸã€‚", en: "I shouldâ€™ve driven more carefully." },
{ jp: "å½¼å¥³ã«æœ¬å½“ã®ã“ã¨ã‚’è©±ã™ã¹ãã˜ã‚ƒãªã‹ã£ãŸã€‚", en: "I shouldnâ€™t have told her the truth." },
{ jp: "ã‚‚ã†å°‘ã—é ‘å¼µã‚‹ã“ã¨ãŒã§ããŸã¨æ€ã†ã€‚", en: "I couldâ€™ve tried a bit harder." },
{ jp: "å½¼ã¯ã‚‚ã£ã¨ä¸Šæ‰‹ãã‚„ã‚ŒãŸã¯ãšã ã€‚", en: "He couldâ€™ve done it better." },
{ jp: "ç§ã¯å½¼å¥³ã‚’åŠ©ã‘ã‚‹ã“ã¨ãŒã§ããŸã®ã«ã€‚", en: "I couldâ€™ve helped her." },
{ jp: "å›ãŒé›»è©±ã—ã¦ãã‚ŒãŸã‚‰è¿ãˆã«è¡Œã‘ãŸã®ã«ã€‚", en: "I couldâ€™ve picked you up if you had called." },
{ jp: "ã‚‚ã—ã‚‚ã£ã¨æ™‚é–“ãŒã‚ã‚Œã°æ—…è¡Œã«è¡Œã‘ãŸã®ã«ã€‚", en: "I wouldâ€™ve gone on a trip if I had more time." },
{ jp: "å½¼ãŒãã“ã«ã„ãŸã‚‰ã€ãã£ã¨åŠ©ã‘ã¦ãã‚ŒãŸã ã‚ã†ã€‚", en: "He wouldâ€™ve helped if he had been there." },
{ jp: "é›¨ãŒé™ã‚‰ãªã‘ã‚Œã°ãƒ”ã‚¯ãƒ‹ãƒƒã‚¯ã«è¡Œã£ã¦ã„ãŸã€‚", en: "We wouldâ€™ve gone on a picnic if it hadnâ€™t rained." },
{ jp: "ã‚‚ã£ã¨è‹¥ã‘ã‚Œã°æŒ‘æˆ¦ã—ã¦ã„ãŸã ã‚ã†ã€‚", en: "I wouldâ€™ve tried if I were younger." },
{ jp: "ã‚ãªãŸãŒè¨€ã£ã¦ãã‚ŒãŸã‚‰ã€ç§ã¯è¡Œã‹ãªã‹ã£ãŸã ã‚ã†ã€‚", en: "I wouldnâ€™t have gone if you had told me." },
{ jp: "å½¼å¥³ãŒã„ãªã‘ã‚Œã°æˆåŠŸã—ãªã‹ã£ãŸã ã‚ã†ã€‚", en: "I wouldnâ€™t have succeeded without her." },
{ jp: "å½¼ã‚’ä¿¡ã˜ãªã‘ã‚Œã°ã‚ˆã‹ã£ãŸã€‚", en: "I shouldnâ€™t have trusted him." },
{ jp: "ã‚‚ã£ã¨æ—©ãå‡ºç™ºã—ã¦ã„ã‚Œã°é–“ã«åˆã£ãŸã®ã«ã€‚", en: "We wouldâ€™ve made it if we had left earlier." },
{ jp: "ãã‚“ãªã«é£Ÿã¹ãªã‘ã‚Œã°ã‚ˆã‹ã£ãŸã€‚", en: "I shouldnâ€™t have eaten so much." },
{ jp: "å½¼ã¯é•·ã„é–“å½¼å¥³ã«æ‹ã‚’ã—ã¦ã„ãŸã€‚", en: "Heâ€™s been in love with her for a long time." },
{ jp: "ç§ã¯ã‚®ã‚¿ãƒ¼ã‚’10å¹´ä»¥ä¸Šå¼¾ã„ã¦ã„ã¾ã™ã€‚", en: "Iâ€™ve played the guitar for over ten years." },
{ jp: "å½¼ã¯æœ€è¿‘ä½“èª¿ãŒè‰¯ãã‚ã‚Šã¾ã›ã‚“ã€‚", en: "Heâ€™s not been feeling well lately." },
{ jp: "å½¼ã‚‰ã¯ã‚‚ã†åˆ¥ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚", en: "Theyâ€™ve already broken up." },
{ jp: "ç§ã¯ä»Šã¾ã§ã“ã‚“ãªã«å¹¸ã›ã‚’æ„Ÿã˜ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", en: "Iâ€™ve never felt this happy before." },
{ jp: "ã‚‚ã—å½¼å¥³ãŒé…ã‚Œãªã‘ã‚Œã°ã€ç§ãŸã¡ã¯ä¸€ç·’ã«æ˜ ç”»ã‚’è¦‹ã‚‰ã‚ŒãŸã®ã«ã€‚", en: "We wouldâ€™ve watched the movie together if she hadnâ€™t been late." }
];

const q4 = [
  { jp: "ç§ã¯å½¼ã«çœŸå®Ÿã‚’è©±ã—ãŸã„ã§ã™ã€‚", en: "I want to tell him the truth." },
  { jp: "ç§ã¯ä»Šæ—¥ã¯ä»•äº‹ã«è¡ŒããŸãã‚ã‚Šã¾ã›ã‚“ã€‚", en: "I donâ€™t want to go to work today." },
  { jp: "å½¼ã¯æ—©ãèµ·ããªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚", en: "He has to get up early." },
  { jp: "ç§ã¯å½¼å¥³ã«ä¼šã‚ãªã„ã‚ˆã†ã«ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚", en: "I have to not meet her." },
  { jp: "å½¼å¥³ã¯ã‚‚ã£ã¨å¥åº·çš„ã§ã„ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚", en: "She has to be healthier." },
  { jp: "ç§ã¯ãã®è©±ã‚’èããŸãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", en: "I didnâ€™t want to hear that story." },
  { jp: "å½¼ã¯å­ã©ã‚‚ã®ã“ã‚ã€ã‚ˆãã‚µãƒƒã‚«ãƒ¼ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚", en: "He used to play soccer when he was a child." },
  { jp: "å½¼å¥³ã¯ã‚‚ã£ã¨é‹å‹•ã™ã‚‹ã¹ãã§ã™ã€‚", en: "She should exercise more." },
  { jp: "ã‚ãªãŸã¯é…åˆ»ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚", en: "You shouldnâ€™t be late." },
  { jp: "å½¼ã«é›»è©±ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ", en: "Can I call him?" },
  { jp: "ç§ã«ãã®ä»•äº‹ã‚’æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã„ãŸã„ã§ã™ã‹ï¼Ÿ", en: "Do you want me to help with that work?" },
  { jp: "å½¼å¥³ã¯ç”˜ã„ã‚‚ã®ã‚’é£Ÿã¹ãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã—ãŸã€‚", en: "She had to not eat sweets." },
  { jp: "å½¼ã¯ä»¥å‰ã€æ±äº¬ã«ä½ã‚“ã§ã„ã¾ã—ãŸã€‚", en: "He used to live in Tokyo." },
  { jp: "å½¼å¥³ã¯ãã®ã“ã¨ã‚’è¨€ã†ã¤ã‚‚ã‚Šã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", en: "She didnâ€™t mean to say that." },
  { jp: "ã‚ãªãŸã¯ãã®å•é¡Œã‚’è§£æ±ºã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚", en: "You have to solve that problem." },
  { jp: "å½¼ã¯é…ãã¾ã§èµ·ãã¦ã„ãªã„ã‚ˆã†ã«ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚", en: "He has to not stay up late." },
  { jp: "ç§ã¯ä»Šæ—¥ã¯æ—©ãå¯ã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚", en: "Iâ€™m going to go to bed early today." },
  { jp: "ç§ãŸã¡ã¯ãã®ä»¶ã«ã¤ã„ã¦è©±ã—åˆã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", en: "We have to talk about that matter." },
  { jp: "å½¼å¥³ã¯ãã‚Œã‚’è«¦ã‚ãŸãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", en: "She didnâ€™t want to give it up." },
  { jp: "ãã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚", en: "Letâ€™s start the project." },
  { jp: "å½¼ã¯å¥åº·ã§ã„ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚", en: "Heâ€™s trying to be healthy." },
  { jp: "ã‚ãªãŸã¯å½¼ã‚’ä¿¡ã˜ã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚", en: "You shouldnâ€™t trust him." },
  { jp: "ç§ã¯ãã®ä»•äº‹ã‚’ã—ãŸãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", en: "I didnâ€™t want to do that job." },
  { jp: "ç§ã¯ä»Šæ—¥ã¯å¤–å‡ºã—ãªã„ã¤ã‚‚ã‚Šã§ã™ã€‚", en: "Iâ€™m not going to go out today." },
  { jp: "å½¼å¥³ã¯ä»Šã‚ˆã‚Šã‚‚å„ªã—ããªã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", en: "She has to be kinder than she is now." },
  { jp: "ã‚ãªãŸã¯æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ã¦ã¿ã‚‹ã¹ãã§ã™ã€‚", en: "You should try something new." },
  { jp: "å½¼ã¯æ€’ã‚‰ãªã„ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã—ã¾ã—ãŸã€‚", en: "He tried to not get angry." },
  { jp: "ç§ã¯å½¼ã«ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ³ã‚¹ã‚’ä¸ãˆãŸã‹ã£ãŸã€‚", en: "I wanted to give him another chance." },
  { jp: "ç§ãŸã¡ã¯ã‚‚ã£ã¨è¦ªåˆ‡ã§ã„ã‚‹ã¹ãã§ã™ã€‚", en: "We should be more kind." },
  { jp: "ã‚ãªãŸã¯å½¼ã«å˜˜ã‚’ã¤ã‹ãªã„ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", en: "You have to not lie to him." }
];

const q5 = [
  {jp:"ç§ã¯æ˜æ—¥å¿™ã—ã„ã§ã—ã‚‡ã†ã€‚", en:"I will be busy tomorrow."},
  {jp:"å½¼ã‚‰ã¯æ¥é€±æ—…è¡Œã™ã‚‹äºˆå®šã§ã™ã€‚", en:"They are going to travel next week."},
  {jp:"å½¼ã¯ã™ãã«æˆ»ã‚‹ã§ã—ã‚‡ã†ã€‚", en:"He'll be back soon."},
  {jp:"ç§ãŸã¡ã¯æ¥å¹´å¼•ã£è¶Šã™äºˆå®šã§ã™ã€‚", en:"We will move next year."},
  {jp:"ãã®ä¼šè­°ã¯æ˜å¾Œæ—¥ã«è¡Œã‚ã‚Œã¾ã™ã€‚", en:"The meeting will be held the day after tomorrow."},
  {jp:"å½¼å¥³ã¯ä»Šæ™©æ¥ã‚‹ã§ã—ã‚‡ã†ã€‚", en:"She is going to come tonight."},
  {jp:"ç§ã¯ãã®æœ¬ã‚’èª­ã‚€ã¤ã‚‚ã‚Šã§ã™ã€‚", en:"I will read that book."},
  {jp:"å¤©æ°—ã¯è‰¯ããªã‚‹ã§ã—ã‚‡ã†ã€‚", en:"The weather will get better."},
  {jp:"å½¼ã¯è©¦é¨“ã«åˆæ ¼ã™ã‚‹ã§ã—ã‚‡ã†ã€‚", en:"He will pass the exam."},
  {jp:"å½¼ã‚‰ã¯æ–°ã—ã„å®¶ã‚’è²·ã†ã§ã—ã‚‡ã†ã€‚", en:"They will buy a new house."},
  {jp:"ç§ã¯ã‚ãªãŸã«é›»è©±ã—ã¾ã™ã€‚", en:"I will call you."},
  {jp:"å½¼ã¯æ¥æœˆé€€è·ã™ã‚‹ã§ã—ã‚‡ã†ã€‚", en:"He will retire next month."},
  {jp:"ç§ãŸã¡ã¯åˆå¾Œã«å‡ºç™ºã—ã¾ã™ã€‚", en:"We are going to leave in the afternoon."},
  {jp:"ãã®è¨ˆç”»ã¯æˆåŠŸã™ã‚‹ã ã‚ã†ã€‚", en:"The plan will succeed."},
  {jp:"ç§ã¯å¤ã«æ—¥æœ¬ã«è¡Œãã¤ã‚‚ã‚Šã§ã™ã€‚", en:"I am going to go to Japan in summer."},
  {jp:"å½¼å¥³ã¯å®¶ã‚’å£²ã‚‹ã§ã—ã‚‡ã†ã€‚", en:"She will sell the house."},
  {jp:"å½¼ã¯é…ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚", en:"He is going to be late."},
  {jp:"ç§ã¯åŒ»è€…ã«ãªã‚Šã¾ã™ã€‚", en:"I will become a doctor."},
  {jp:"ã‚ãªãŸã¯ãã‚Œã‚’é”æˆã§ãã‚‹ã§ã—ã‚‡ã†ã€‚", en:"You will achieve that."},
  {jp:"å½¼ã‚‰ã¯æ¬¡ã®é€±æœ«ã«ä¼šã†ã§ã—ã‚‡ã†ã€‚", en:"They will meet next weekend."},
  {jp:"ç§ã¯æ˜æ—¥ã®æœãã“ã«ã„ã¾ã™ã€‚", en:"I will be there tomorrow morning."},
  {jp:"å½¼å¥³ã¯æ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚", en:"She will help us."},
  {jp:"ç§ã¯ã™ãã«å§‹ã‚ã¾ã™ã€‚", en:"I will start right away."},
  {jp:"å½¼ã¯ãã®ã‚¤ãƒ™ãƒ³ãƒˆã«å‚åŠ ã™ã‚‹ã§ã—ã‚‡ã†ã€‚", en:"He will attend the event."},
  {jp:"å½¼å¥³ã¯æ¥é€±æˆ»ã‚‹äºˆå®šã§ã™ã€‚", en:"She is going to return next week."},
  {jp:"æ–°ã—ã„ã‚·ã‚¹ãƒ†ãƒ ã¯æ¥å¹´å°å…¥ã•ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚", en:"The new system will be implemented next year."},
  {jp:"ç§ã¯ä»Šå¤œå¤•é£Ÿã‚’ä½œã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚", en:"I am going to cook dinner tonight."},
  {jp:"å½¼ã¯ã“ã®ä»•äº‹ã‚’çµ‚ãˆã‚‹ã§ã—ã‚‡ã†ã€‚", en:"He will finish this work."},
  {jp:"ç§ã¯æ¥é€±ã€äº¬éƒ½ã«è¡Œãäºˆå®šã§ã™ã€‚", en:"I will go to Kyoto next week."},
  {jp:"ç§ãŸã¡ã¯è¿‘ã„ã†ã¡ã«è©±ã—ã¾ã™ã€‚", en:"We will talk soon."}
];

const q6 = [
  {jp:"ã‚‚ã—ç§ãŒã‚ãªãŸãªã‚‰ã€ãã®ä»•äº‹ã‚’å—ã‘ã‚‹ã§ã—ã‚‡ã†ã€‚", en:"If I were you, I would take the job."},
  {jp:"ã‚‚ã£ã¨æ—©ãçŸ¥ã£ã¦ã„ãŸã‚‰ã‚ˆã‹ã£ãŸã®ã«ã€‚", en:"If I had known earlier, I would have helped."},
  {jp:"å½¼ãŒè‹¥ã‘ã‚Œã°ã‚‚ã£ã¨ç„¡ç†ã‚’ã™ã‚‹ã ã‚ã†ã€‚", en:"If he were younger, he would try harder."},
  {jp:"é¡˜ã‚ãã°ç§ã¯ãƒ”ã‚¢ãƒãŒå¼¾ã‘ãŸã‚‰ã„ã„ã®ã«ã€‚", en:"I wish I could play the piano."},
  {jp:"ã‚‚ã—é›¨ãŒé™ã‚‰ãªã‘ã‚Œã°ã€ç§ãŸã¡ã¯è¡Œã£ãŸã ã‚ã†ã€‚", en:"If it hadn't rained, we would have gone."},
  {jp:"ã‚‚ã—æ™‚é–“ãŒã‚ã‚Œã°ã€å½¼ã¯æ¥ã‚‹ã ã‚ã†ã€‚", en:"If he had time, he would come."},
  {jp:"é¡˜ã£ã¦ã„ã¾ã™ã€ã‚ãªãŸãŒå¹¸ã›ã§ã‚ã‚‹ã“ã¨ã‚’ã€‚", en:"I wish you were happy."},
  {jp:"ã‚‚ã—å½¼ãŒåŠ©ã‘ã¦ãã‚ŒãŸã‚‰ã‚ˆã‹ã£ãŸã®ã«ã€‚", en:"If only he had helped us."},
  {jp:"å½¼å¥³ã¯ã‚‚ã£ã¨å‹‰å¼·ã—ã¦ã„ã‚Œã°åˆæ ¼ã—ãŸã ã‚ã†ã€‚", en:"She would have passed if she had studied more."},
  {jp:"ã‚‚ã—ç§ãŒãŠé‡‘æŒã¡ãªã‚‰ã€ä¸–ç•Œä¸€å‘¨ã™ã‚‹ã ã‚ã†ã€‚", en:"If I were rich, I would travel around the world."},
  {jp:"å½¼ãŒæ—©ãæ¥ã‚Œã°åŠ©ã‹ã‚‹ã®ã«ã€‚", en:"If he came earlier, it would be helpful."},
  {jp:"ã‚‚ã—ç§ãŒæ™‚é–“ã‚’æˆ»ã›ãŸã‚‰ã€é•ã†é¸æŠã‚’ã™ã‚‹ã€‚", en:"If I could turn back time, I'd choose differently."},
  {jp:"å½¼ãŒãã‚Œã‚’è¨€ã‚ãªã‘ã‚Œã°ã‚ˆã‹ã£ãŸã®ã«ã€‚", en:"I wish he hadn't said that."},
  {jp:"ã‚‚ã—é“ãŒç©ºã„ã¦ã„ã‚Œã°ã€ã‚‚ã£ã¨æ—©ãç€ã„ãŸã ã‚ã†ã€‚", en:"If the road had been clear, we would have arrived earlier."},
  {jp:"ã‚‚ã—ã‚ã®æ™‚è¡Œã£ã¦ã„ã‚Œã°ã€ä¼šãˆãŸã ã‚ã†ã€‚", en:"If I had gone then, I would have met him."},
  {jp:"å½¼å¥³ãŒçŸ¥ã£ã¦ã„ã‚Œã°æ‰‹ä¼ã£ãŸã ã‚ã†ã€‚", en:"If she had known, she would have helped."},
  {jp:"ã‚‚ã—ç§ãŒé³¥ãªã‚‰ç©ºã‚’é£›ã³ãŸã„ã€‚", en:"If I were a bird, I would fly in the sky."},
  {jp:"ãã®çŸ¥ã‚‰ã›ã‚’å—ã‘ã¦ã„ã‚Œã°ã€é©šã‹ãªã‹ã£ãŸã ã‚ã†ã€‚", en:"If I had been informed, I wouldn't have been surprised."},
  {jp:"ã‚‚ã—ç§ãŸã¡ãŒè‹¥ã‘ã‚Œã°ã€ã‚‚ã£ã¨å†’é™ºã™ã‚‹ã ã‚ã†ã€‚", en:"If we were younger, we would be more adventurous."},
  {jp:"å½¼ãŒã‚‚ã£ã¨å„ªã—ã‹ã£ãŸã‚‰é•ã£ãŸã‹ã‚‚ã—ã‚Œãªã„ã€‚", en:"If he had been kinder, things might have been different."},
  {jp:"ã‚‚ã—å‹‰å¼·ã—ã¦ã„ã‚Œã°åˆæ ¼ã—ãŸã ã‚ã†ã€‚", en:"Had I studied, I would have passed the test."},
  {jp:"ç§ã¯ã‚‚ã†å°‘ã—å‹‡æ•¢ãªã‚‰è¨€ã£ãŸã ã‚ã†ã€‚", en:"If I had been braver, I would have spoken up."},
  {jp:"ã‚‚ã—å½¼å¥³ãŒæ¥ãŸã‚‰ã€å–œã‚“ã ã ã‚ã†ã€‚", en:"If she had come, we would have been happy."},
  {jp:"ã‚ã®æ™‚è«¦ã‚ãªã‘ã‚Œã°ã‚ˆã‹ã£ãŸã€‚", en:"I wish I hadn't given up then."},
  {jp:"ã‚‚ã—å½¼ãŒåŠ©è¨€ã‚’èã„ã¦ã„ãŸã‚‰æˆåŠŸã—ãŸã‹ã‚‚ã—ã‚Œãªã„ã€‚", en:"If he had listened to the advice, he might have succeeded."},
  {jp:"ç§ãŒã‚‚ã£ã¨è‹¥ã‹ã£ãŸã‚‰ã‚ãã“ã¸è¡Œã£ãŸã ã‚ã†ã€‚", en:"If I were younger, I would go there."},
  {jp:"ã‚‚ã—å½¼ã‚‰ãŒæ‰‹ä¼ã£ã¦ãã‚ŒãŸã‚‰ã™ãçµ‚ã‚ã£ãŸã ã‚ã†ã€‚", en:"If they had helped, it would have finished quickly."},
  {jp:"å½¼ãŒè¡Œã‹ãªã‘ã‚Œã°ã‚ˆã‹ã£ãŸã®ã«ã€‚", en:"I wish he hadn't gone."},
  {jp:"ã‚‚ã—æ™‚é–“ãŒã‚ã‚Œã°ã€ã‚‚ã£ã¨æ—…è¡Œã—ãŸã„ã§ã™ã€‚", en:"If I had more time, I would travel more."},
  {jp:"ã‚‚ã—æ™‚é–“ãŒæˆ»ã›ãŸã‚‰å…¨ã¦ç›´ã—ãŸã„ã€‚", en:"If I could go back, I'd fix everything."}
];

const q7 = [
  {jp:"ãã®æœ¬ã¯å½¼ã«ã‚ˆã£ã¦æ›¸ã‹ã‚Œã¾ã—ãŸã€‚", en:"The book was written by him."},
  {jp:"çª“ã¯æ˜¨æ—¥æƒé™¤ã•ã‚Œã¾ã—ãŸã€‚", en:"The window was cleaned yesterday."},
  {jp:"ã“ã®æ­Œã¯å¤šãã®äººã«æ­Œã‚ã‚Œã¦ã„ã¾ã™ã€‚", en:"This song is sung by many people."},
  {jp:"ãã®è»Šã¯ä¿®ç†ã•ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚", en:"The car will be repaired."},
  {jp:"ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã¯å½¼å¥³ã«æ¸¡ã•ã‚Œã¾ã—ãŸã€‚", en:"The present was given to her."},
  {jp:"æ–™ç†ã¯æ¯ã«ã‚ˆã£ã¦ä½œã‚‰ã‚Œã¾ã—ãŸã€‚", en:"The meal was cooked by my mother."},
  {jp:"ãã®éƒ¨å±‹ã¯ç¾åœ¨ä½¿ã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", en:"The room is not used now."},
  {jp:"ãã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å®Œäº†ã•ã‚Œã¾ã—ãŸã€‚", en:"The project has been completed."},
  {jp:"æ‰‹ç´™ã¯å½¼ã«é€ã‚‰ã‚Œã¾ã—ãŸã€‚", en:"The letter was sent to him."},
  {jp:"ãã®æ˜ ç”»ã¯å¤šãã®è³ã‚’å—è³ã—ãŸã€‚", en:"The movie was awarded many prizes."},
  {jp:"å•é¡Œã¯æ—©ãè§£æ±ºã•ã‚Œã‚‹ã¹ãã§ã™ã€‚", en:"The issue should be resolved soon."},
  {jp:"ãã®ä»•äº‹ã¯æ—¢ã«ä¸ãˆã‚‰ã‚Œã¾ã—ãŸã€‚", en:"The job has already been assigned."},
  {jp:"ç‰›ä¹³ã¯å†·è”µåº«ã«å…¥ã‚Œã‚‰ã‚ŒãŸã€‚", en:"The milk was put in the fridge."},
  {jp:"ãã®æ­Œè©ã¯å¿˜ã‚Œã‚‰ã‚ŒãŸã€‚", en:"The lyrics were forgotten."},
  {jp:"å½¼å¥³ã¯ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã§æ­“è¿ã•ã‚Œã¾ã—ãŸã€‚", en:"She was welcomed at the party."},
  {jp:"ãã®å³¶ã¯è¦³å…‰åœ°ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ã€‚", en:"The island is known as a tourist spot."},
  {jp:"ãã®ä¼šè­°ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚", en:"The meeting was cancelled."},
  {jp:"ãã®ä½œå“ã¯å±•ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚", en:"The piece is displayed at the gallery."},
  {jp:"å½¼ã®æ„è¦‹ã¯ç„¡è¦–ã•ã‚ŒãŸã€‚", en:"His opinion was ignored."},
  {jp:"çª“ã‚¬ãƒ©ã‚¹ã¯å‰²ã‚‰ã‚ŒãŸã€‚", en:"The window glass was broken."},
  {jp:"ãã®ãƒ‰ã‚¢ã¯è‡ªå‹•ã§é–‰ã‚ã‚‰ã‚Œã‚‹ã€‚", en:"The door is closed automatically."},
  {jp:"å†™çœŸã¯ãƒãƒƒãƒˆã§å…±æœ‰ã•ã‚ŒãŸã€‚", en:"The photos were shared on the internet."},
  {jp:"ãã®ã‚­ãƒ¼ã¯è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚", en:"The key was found."},
  {jp:"ãã®è¨ˆç”»ã¯è©³ã—ãèª¬æ˜ã•ã‚ŒãŸã€‚", en:"The plan was explained in detail."},
  {jp:"ãã®çŸ¥ã‚‰ã›ã¯å½¼ã‚‰ã«ä¼ãˆã‚‰ã‚ŒãŸã€‚", en:"The news was conveyed to them."},
  {jp:"ãã®çŠ¬ã¯å…¬åœ’ã§è¦‹ã¤ã‘ã‚‰ã‚ŒãŸã€‚", en:"The dog was found in the park."},
  {jp:"ãã®ã‚³ãƒ³ã‚µãƒ¼ãƒˆã¯ä¸­æ­¢ã«ãªã£ãŸã€‚", en:"The concert was cancelled."},
  {jp:"ãã®ä»•äº‹ã¯ãƒ—ãƒ­ã«ã‚ˆã£ã¦å‡¦ç†ã•ã‚ŒãŸã€‚", en:"The job was handled by a professional."},
  {jp:"ãã®ãƒ¬ãƒãƒ¼ãƒˆã¯å½¼ã«ã‚ˆã£ã¦æ›¸ã‹ã‚Œã¾ã—ãŸã€‚", en:"The report was written by him."},
  {jp:"ãã®è³ã¯å½¼ã«æˆä¸ã•ã‚ŒãŸã€‚", en:"The award was given to him."}
];

const q8 = [
  {jp:"ç§ã¯ã‚‚ã†å¤•é£Ÿã‚’é£Ÿã¹ã¾ã—ãŸã€‚", en:"I have already had dinner."},
  {jp:"å½¼ã¯3å¹´é–“ã“ã“ã«ä½ã‚“ã§ã„ã¾ã™ã€‚", en:"He has lived here for three years."},
  {jp:"å½¼å¥³ã¯å®¿é¡Œã‚’çµ‚ãˆã¾ã—ãŸã€‚", en:"She has finished her homework."},
  {jp:"å½¼ã‚‰ã¯ã‚‚ã†å‡ºç™ºã—ã¾ã—ãŸã€‚", en:"They have already left."},
  {jp:"ç§ã¯ãã®æ˜ ç”»ã‚’è¦‹ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚", en:"I have seen that movie."},
  {jp:"å½¼ã¯ã¾ã æ¥ã¦ã„ã¾ã›ã‚“ã€‚", en:"He hasn't come yet."},
  {jp:"ç§ãŸã¡ã¯ã¾ã çµè«–ã«é”ã—ã¦ã„ã¾ã›ã‚“ã€‚", en:"We haven't reached a conclusion yet."},
  {jp:"å½¼å¥³ã¯ã“ã®æœ¬ã‚’ä½•åº¦ã‚‚èª­ã‚“ã§ã„ã¾ã™ã€‚", en:"She has read this book many times."},
  {jp:"å½¼ã¯æœ€è¿‘ç—…æ°—ã§ã—ãŸã€‚", en:"He has been ill recently."},
  {jp:"ç§ã¯ãã®æ‰‹ç´™ã‚’å—ã‘å–ã‚Šã¾ã—ãŸã€‚", en:"I have received the letter."},
  {jp:"å½¼ã‚‰ã¯ã‚‚ã†æ˜¼é£Ÿã‚’é£Ÿã¹ã¾ã—ãŸã‹ï¼Ÿ", en:"Have they eaten lunch already?"},
  {jp:"ç§ã¯ã“ã“ã«æ¥ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚", en:"I have been here before."},
  {jp:"å½¼å¥³ã¯æ—¢ã«æ±ºå®šã‚’ä¸‹ã—ãŸã€‚", en:"She has already made the decision."},
  {jp:"ç§ãŸã¡ã¯è¿‘ã„ã†ã¡ã«ä¼šã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚", en:"We have met recently."},
  {jp:"å½¼ã¯ãã®è·å‹™ã‚’çµ‚ãˆãŸã€‚", en:"He has completed the duty."},
  {jp:"ç§ã¯ãã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èã„ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚", en:"I have heard that news."},
  {jp:"å½¼å¥³ã¯ã¾ã å®¿é¡Œã‚’çµ‚ãˆã¦ã„ãªã„ã€‚", en:"She hasn't finished her homework yet."},
  {jp:"å½¼ã¯ãšã£ã¨ãã“ã«ã„ãŸã€‚", en:"He has been there all along."},
  {jp:"ç§ã¯ä»Šã¾ã§ã«å¤šãã®å›½ã‚’è¨ªã‚ŒãŸã€‚", en:"I have visited many countries."},
  {jp:"ç§é”ã¯ç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸã€‚", en:"We have achieved our goal."},
  {jp:"å½¼ã¯ã™ã§ã«å‡ºç™ºã—ã¦ã„ã‚‹ã€‚", en:"He has already departed."},
  {jp:"ç§ã¯ã¾ã ãã‚Œã‚’ã‚„ã£ã¦ã„ãªã„ã€‚", en:"I haven't done it yet."},
  {jp:"å½¼å¥³ã¯ã™ã§ã«é›»è©±ã—ãŸã€‚", en:"She has already called."},
  {jp:"ãã‚Œã¯ã‚‚ã†ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚", en:"It has been used already."},
  {jp:"ç§ã¯é•·å¹´ã“ã“ã§åƒã„ã¦ã„ã¾ã™ã€‚", en:"I have worked here for many years."},
  {jp:"å½¼ã‚‰ã¯æœ€è¿‘è»¢è·ã—ãŸã€‚", en:"They have recently changed jobs."},
  {jp:"ç§ã¯ãšã£ã¨ãã‚Œã‚’æ¢ã—ã¦ã„ã‚‹ã€‚", en:"I have been looking for it."},
  {jp:"å½¼å¥³ã¯ã“ã‚Œã¾ã§ã«ãã‚Œã‚’è©¦ã—ãŸã“ã¨ãŒã‚ã‚‹ã€‚", en:"She has tried that before."},
  {jp:"æˆ‘ã€…ã¯ã™ã§ã«è¨ˆç”»ã‚’ç«‹ã¦ã¾ã—ãŸã€‚", en:"We have already made plans."},
  {jp:"å½¼å¥³ã¯ã¡ã‚‡ã†ã©ä»•äº‹ã‚’çµ‚ãˆãŸã¨ã“ã‚ã§ã™ã€‚", en:"She has just finished her work."}
];

const ALL = [
  ...q0.map(q=>({...q,type:0})),
  ...q1.map(q=>({...q,type:1})),
  ...q2.map(q=>({...q,type:2})),
  ...q3.map(q=>({...q,type:3})),
  ...q4.map(q=>({...q,type:4})),
  ...q5.map(q=>({...q,type:5})),
  ...q6.map(q=>({...q,type:6})),
  ...q7.map(q=>({...q,type:7})),
  ...q8.map(q=>({...q,type:8}))
];

/* åŒç¾©èªè¾æ›¸ï¼ˆç°¡æ˜“ï¼‰*/
const SYN = {
  "do the dishes":["wash dishes","do dishes","wash the dishes","clean the dishes"],
  "have dinner":["eat dinner","eat supper","have supper"],
  "call":"phone",
  "buy":["purchase","get"],
  "ask":"request",
  "help":["assist"],
  "finish":["complete"],
  "start":["begin"],
  "look forward to":["anticipate","await"],
  "kids":["children"]
};

/* çŠ¶æ…‹ */
let currentType = 0;
let currentIndex = 0;
let filtered = ALL.filter(i=>i.type===0);
let shuffledLists = {};
let scores = {};
const STORAGE_SCORES = "epu_scores_v1";
const STORAGE_STATE = "epu_state_v1";

/* åˆæœŸåŒ–ã®ãŸã‚ã®é…åˆ—ä½œæˆ */
for(let t=0;t<9;t++){
  const arr = ALL.filter(q=>q.type===t);
  shuffledLists[t] = [...arr];
  scores[t] = {correct:0, wrong:0, shown:0};
}

/* UIè¦ç´  */
const typeSelect = document.getElementById("typeSelect");
const modeSelect = document.getElementById("modeSelect");
const questionJP = document.getElementById("questionJP");
const answerEl = document.getElementById("answer");
const feedback = document.getElementById("feedback");
const exampleEN = document.getElementById("exampleEN");
const scoreboard = document.getElementById("scoreboard");
const ttsLang = document.getElementById("ttsLang");
const searchInput = document.getElementById("searchInput");
const acceptPartial = document.getElementById("acceptPartial");
const allListDiv = document.getElementById("allList");
const metaInfo = document.getElementById("metaInfo"); // kept but kept empty per requirement

/* fill type select */
TYPE_LABELS.forEach((lab,i)=>{
  const opt = document.createElement("option");
  opt.value = i;
  opt.textContent = `${i+1}. ${lab}`;
  typeSelect.appendChild(opt);
});

/* ã‚¤ãƒ™ãƒ³ãƒˆ */
typeSelect.addEventListener("change", ()=>{
  currentType = Number(typeSelect.value);
  currentIndex = 0;
  prepareFiltered();
  showQuestion();
  updateScoreboard();
  hideAllList();
  saveState();
});
modeSelect.addEventListener("change", ()=>{
  prepareFiltered();
  showQuestion();
  saveState();
});
document.getElementById("checkBtn").addEventListener("click", ()=>checkAnswer());
document.getElementById("nextBtn").addEventListener("click", ()=>nextQuestion());
document.getElementById("speakBtn").addEventListener("click", ()=>speakCurrent());
document.getElementById("speakBothBtn").addEventListener("click", ()=>speakENthenJP());
document.getElementById("voiceBtn").addEventListener("click", ()=>startRecognition());
document.getElementById("showAllBtn").addEventListener("click", ()=>toggleAllList());
document.getElementById("resetScoreBtn").addEventListener("click", ()=>resetScores());
searchInput.addEventListener("input", ()=>showQuestion());
answerEl.addEventListener("input", ()=>{ /* auto-save input for UX but not necessary */ saveState(); });

/* prepare filtered list based on mode */
function prepareFiltered(){
  const arr = ALL.filter(q=>q.type===currentType);
  if(modeSelect.value==="shuffle"){
    if(!shuffledLists[currentType] || shuffledLists[currentType].length!==arr.length){
      shuffledLists[currentType] = shuffle([...arr]);
    }
    filtered = shuffledLists[currentType];
  } else {
    filtered = arr;
  }
}

/* show question (JP only). metaInfo (EN) intentionally NOT shown here */
function showQuestion(){
  prepareFiltered();
  const search = (searchInput.value||"").trim().toLowerCase();
  let q = filtered[currentIndex % filtered.length];
  if(search){
    const matched = filtered.filter(x=> x.jp.toLowerCase().includes(search) || x.en.toLowerCase().includes(search) );
    if(matched.length>0) q = matched[0];
  }
  questionJP.textContent = `[${TYPE_LABELS[currentType]} ${currentIndex+1}/${filtered.length}] ${q.jp}`;
  // metaInfo remains empty (do not display the answer here)
  metaInfo.textContent = "";
  answerEl.value = "";
  feedback.textContent = "";
  exampleEN.textContent = "";
  updateScoreboard();
  saveState();
}

/* ---------- åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆçŸ­ç¸®å½¢ãƒ»åŒç¾©èªãƒ»æ›–æ˜§ä¸€è‡´å¯¾å¿œï¼‰ ---------- */
function normalizeText(s){
  if(!s) return "";
  return s.toLowerCase()
    .replace(/â€™/g,"'")
    .replace(/\bi'm\b/g,"i am")
    .replace(/\byou're\b/g,"you are")
    .replace(/\bhe's\b/g,"he is")
    .replace(/\bshe's\b/g,"she is")
    .replace(/\bit's\b/g,"it is")
    .replace(/\bcan't\b/g,"cannot")
    .replace(/\bwon't\b/g,"will not")
    .replace(/\bdon't\b/g,"do not")
    .replace(/\bdoesn't\b/g,"does not")
    .replace(/\bi've\b/g,"i have")
    .replace(/\bthey'll\b/g,"they will")
    .replace(/[.,!?;:"]/g,"")
    .replace(/\s+/g," ").trim();
}

function escapeReg(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"); }

function replaceSynonyms(s){
  let r = s;
  for(const [k,v] of Object.entries(SYN)){
    if(Array.isArray(v)){
      v.forEach(sym=>{
        const re = new RegExp("\\b"+escapeReg(sym)+"\\b","gi");
        if(re.test(r)) r = r.replace(re,k);
      });
    } else {
      const re = new RegExp("\\b"+escapeReg(v)+"\\b","gi");
      if(re.test(r)) r = r.replace(re,k);
    }
  }
  return r;
}

function levenshtein(a,b){
  const m=a.length,n=b.length;
  if(m===0) return n; if(n===0) return m;
  const dp = Array.from({length:m+1},()=>Array(n+1).fill(0));
  for(let i=0;i<=m;i++) dp[i][0]=i;
  for(let j=0;j<=n;j++) dp[0][j]=j;
  for(let i=1;i<=m;i++){
    for(let j=1;j<=n;j++){
      const cost = a[i-1]===b[j-1]?0:1;
      dp[i][j]=Math.min(dp[i-1][j]+1,dp[i][j-1]+1,dp[i-1][j-1]+cost);
    }
  }
  return dp[m][n];
}

function isEquivalent(userRaw, correctRaw){
  if(!userRaw || !correctRaw) return false;
  const u0 = normalizeText(userRaw);
  const c0 = normalizeText(correctRaw);
  if(u0 === c0) return true;
  const u1 = replaceSynonyms(u0);
  const c1 = replaceSynonyms(c0);
  if(u1 === c1) return true;
  const wa = u1.split(" ").filter(Boolean);
  const wb = c1.split(" ").filter(Boolean);
  const common = wa.filter(w=> wb.includes(w)).length;
  const overlapRatio = common / Math.max(wa.length||1, wb.length||1);
  if(overlapRatio >= 0.72) return true;
  const dist = levenshtein(u1, c1);
  const normDist = dist / Math.max(u1.length, c1.length, 1);
  if(normDist <= 0.28) return true;
  if(acceptPartial.checked){
    if(overlapRatio >= 0.55) return true;
  }
  return false;
}

/* åˆ¤å®šå‡¦ç† â€” ã“ã“ã‚’ä¿®æ­£ï¼šæ­£è§£æ™‚ã§ã‚‚æ¨¡ç¯„è§£ç­”ã‚’è¡¨ç¤º */
function checkAnswer(){
  prepareFiltered();
  const q = filtered[currentIndex % filtered.length];
  const user = answerEl.value.trim();
  if(!user){
    feedback.style.color="#b45309";
    feedback.textContent = "ç­”ãˆã‚’å…¥åŠ›ã™ã‚‹ã‹éŸ³å£°å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
    exampleEN.textContent = "";
    return;
  }
  const ok = isEquivalent(user, q.en);
  if(ok){
    feedback.style.color="#059669";
    feedback.textContent = "âœ… æ­£è§£ã§ã™ï¼";
    scores[currentType].correct++;
    scores[currentType].shown++;
    // æ–°ä»•æ§˜ï¼šæ­£è§£ã§ã‚‚æ¨¡ç¯„è§£ç­”ã‚’è¡¨ç¤º
    exampleEN.textContent = `æ¨¡ç¯„è§£ç­”ï¼ˆä¾‹ï¼‰ï¼š ${q.en}`;
  } else {
    feedback.style.color="#dc2626";
    feedback.textContent = `âŒ ä¸æ­£è§£ã§ã™ã€‚`;
    exampleEN.textContent = `æ¨¡ç¯„è§£ç­”ï¼ˆä¾‹ï¼‰ï¼š ${q.en}`;
    scores[currentType].wrong++;
    scores[currentType].shown++;
  }
  saveScores();
  updateScoreboard();
  saveState();
}

/* æ¬¡ã®å•é¡Œ */
function nextQuestion(){
  currentIndex = (currentIndex + 1) % filtered.length;
  showQuestion();
  saveState();
}

/* TTS */
function speak(text, lang){
  if(!text) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang || document.getElementById("ttsLang").value || "en-US";
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}
function speakCurrent(){
  const q = filtered[currentIndex % filtered.length];
  speak(q.en, "en-US");
}
function speakENthenJP(){
  const q = filtered[currentIndex % filtered.length];
  speak(q.en, "en-US");
  setTimeout(()=>speak(q.jp, "ja-JP"), 800);
}

/* STT (ãƒ–ãƒ©ã‚¦ã‚¶å´) */
let recognizer = null;
function startRecognition(){
  const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRec){
    alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeæ¨å¥¨ã€‚");
    return;
  }
  if(recognizer){ recognizer.abort(); recognizer = null; }
  recognizer = new SpeechRec();
  recognizer.lang = "en-US";
  recognizer.interimResults = false;
  recognizer.maxAlternatives = 1;
  recognizer.onresult = (ev)=>{
    const t = ev.results[0][0].transcript;
    answerEl.value = t;
    saveState();
  };
  recognizer.onerror = (e)=>{ alert("éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼: " + (e.error||e.message)); };
  recognizer.onend = ()=>{ recognizer = null; };
  recognizer.start();
}

/* ã‚¹ã‚³ã‚¢ç®¡ç† */
function saveScores(){
  try{ localStorage.setItem(STORAGE_SCORES, JSON.stringify(scores)); }catch(e){}
}
function loadScores(){
  try{
    const raw = localStorage.getItem(STORAGE_SCORES);
    if(raw){
      const tmp = JSON.parse(raw);
      if(tmp && typeof tmp === "object") scores = tmp;
    }
  }catch(e){}
}

/* è‡ªå‹•ä¿å­˜ï¼†å¾©å…ƒï¼ˆã‚¿ã‚¤ãƒ—ãƒ»indexãƒ»modeãƒ»scoresãƒ»shuffledListsï¼‰ */
function saveState(){
  try{
    const payload = {
      currentType,
      currentIndex,
      mode: modeSelect.value,
      scores,
      shuffledLists,
      savedAt: new Date().toISOString()
    };
    localStorage.setItem(STORAGE_STATE, JSON.stringify(payload));
  }catch(e){}
}
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_STATE);
    if(raw){
      const obj = JSON.parse(raw);
      if(obj){
        if(typeof obj.currentType === "number") currentType = obj.currentType;
        if(typeof obj.currentIndex === "number") currentIndex = obj.currentIndex;
        if(obj.mode) modeSelect.value = obj.mode;
        if(obj.scores) scores = obj.scores;
        if(obj.shuffledLists) shuffledLists = obj.shuffledLists;
      }
    }
  }catch(e){}
}

/* reset scores */
function resetScores(){
  if(!confirm("ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
  for(let t=0;t<9;t++) scores[t] = {correct:0,wrong:0,shown:0};
  saveScores(); saveState(); updateScoreboard();
}

/* update scoreboard UI */
function updateScoreboard(){
  scoreboard.innerHTML = "";
  let totalCorrect=0, totalWrong=0, totalShown=0;
  for(let t=0;t<9;t++){
    const s = scores[t] || {correct:0,wrong:0,shown:0};
    totalCorrect += s.correct; totalWrong += s.wrong; totalShown += s.shown;
    const box = document.createElement("div");
    box.className = "scorebox";
    const acc = s.shown===0?0:Math.round((s.correct/(s.shown))*100);
    box.innerHTML = `<div><strong>${TYPE_LABELS[t]}</strong></div>
      <div class="small">æ­£è§£:${s.correct} ä¸æ­£è§£:${s.wrong} å›ç­”:${s.shown}</div>
      <div class="small">æ­£ç­”ç‡: ${acc}%</div>`;
    if(t===currentType) box.style.border="1px solid rgba(37,99,235,0.9)";
    scoreboard.appendChild(box);
  }
  const overall = document.createElement("div");
  overall.className = "scorebox";
  const overallAcc = totalShown===0?0:Math.round((totalCorrect/(totalShown))*100);
  overall.innerHTML = `<div><strong>åˆè¨ˆ</strong></div>
    <div class="small">æ­£è§£:${totalCorrect} ä¸æ­£è§£:${totalWrong} å›ç­”:${totalShown}</div>
    <div class="small">ç·åˆæ­£ç­”ç‡: ${overallAcc}%</div>`;
  scoreboard.appendChild(overall);
}

/* å…¨å•è¡¨ç¤º */
function toggleAllList(){
  if(allListDiv.style.display==="block"){ hideAllList(); return; }
  const arr = ALL.filter(q=>q.type===currentType);
  allListDiv.style.display="block";
  allListDiv.innerHTML = `<h3>${TYPE_LABELS[currentType]} å…¨${arr.length}å•</h3>`;
  const ul = document.createElement("ol");
  arr.forEach((q,i)=>{
    const li = document.createElement("li");
    li.style.margin="6px 0";
    li.innerHTML = `<strong>JP:</strong> ${q.jp} <br/><strong>EN:</strong> ${q.en} <button onclick="copyExample('${escapeForJs(q.en)}')">ä¾‹æ–‡ã‚’ã‚³ãƒ”ãƒ¼</button>`;
    ul.appendChild(li);
  });
  allListDiv.appendChild(ul);
  window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'});
}
function hideAllList(){ allListDiv.style.display="none"; allListDiv.innerHTML=""; }
function copyExample(txt){ navigator.clipboard && navigator.clipboard.writeText(txt); alert("è‹±æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚"); }
function escapeForJs(s){ return s.replace(/'/g,"\\'").replace(/"/g,'\\"'); }

/* shuffle helper */
function shuffle(a){ const ar=[...a]; for(let i=ar.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [ar[i],ar[j]]=[ar[j],ar[i]]; } return ar; }

/* åˆæœŸåŒ–ï¼šçŠ¶æ…‹å¾©å…ƒãƒ»è¡¨ç¤º */
(function init(){
  loadScores();
  loadState();
  // ensure UI reflects loaded state
  typeSelect.value = currentType;
  modeSelect.value = modeSelect.value || "seq";
  prepareFiltered();
  // clamp currentIndex
  if(!filtered || filtered.length===0) filtered = ALL.filter(q=>q.type===currentType);
  currentIndex = Math.min(currentIndex, Math.max(0, filtered.length-1));
  showQuestion();
  updateScoreboard();
})();

/* beforeunload save */
window.addEventListener("beforeunload", ()=>{ saveScores(); saveState(); });

</script>
</body>
</html>
