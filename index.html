<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç¬é–“è‹±ä½œæ–‡ ç·´ç¿’ã‚¢ãƒ—ãƒª</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f6f8fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    #progress {
      text-align: center;
      font-weight: bold;
      margin-bottom: 15px;
      color: #0078d7;
    }
    #question {
      font-size: 1.2em;
      margin-bottom: 15px;
      padding: 10px;
      background: #f0f4ff;
      border-radius: 8px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
    }
    button {
      background: #0078d7;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 8px;
    }
    button:hover {
      background: #005fa3;
    }
    #result, #feedback {
      margin-top: 10px;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ç¬é–“è‹±ä½œæ–‡ ç·´ç¿’ã‚¢ãƒ—ãƒª</h1>
    <div id="progress">ç¬¬1å• / å…¨20å•</div>
    <div id="question">ã“ã“ã«å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
    <input type="text" id="answer" placeholder="è‹±èªã§ç­”ãˆã¦ãã ã•ã„" />
    <div>
      <button id="submit">è§£ç­”</button>
      <button id="next" style="display:none;">æ¬¡ã¸</button>
    </div>
    <div id="feedback"></div>
    <div id="result"></div>
  </div>

  <script>
    const questionsData = [
      { jp: "ç§æ˜”ç¾å®¹å¸«ã ã£ãŸã®ã‚ˆ", en: "I used to be a hairstylist." },
      { jp: "ãã®ç®±ã€ã™ã£ã”ã„é‡ã‹ã£ãŸã‚ˆ", en: "The box was so heavy." },
      { jp: "ã‚³ãƒ¼ãƒ’ãƒ¼ã¯å…¨ãé£²ã¾ãªã„ã‚ã­ã€œ", en: "I don't drink coffee at all." },
      { jp: "ç§ã¯æ¯é€±æœ«ã€ãƒ¨ã‚¬ã—ã¦ã‚‹ã‚ˆ", en: "I do yoga every weekend." },
      { jp: "ç§ã®å¨˜ã€é‡èœå«Œã„ãªã®", en: "My daughter doesn't like vegetables." },
      { jp: "ãã®ãƒ›ãƒ†ãƒ«ã€å¤§ãã„ãƒ—ãƒ¼ãƒ«ä»˜ããªã®", en: "The hotel has a big pool." },
      { jp: "ç§ã“ãªã„ã ãã®ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³è¡Œã£ãŸã‚ˆ", en: "I went to the restaurant the other day." },
      { jp: "æ˜¨æ—¥ã¯ã„ã£ã±ã„ã‚„ã‚‹ã“ã¨ã‚ã£ã¦....", en: "I had a lot of things to do yesterday." },
      { jp: "ä»Šãƒ†ãƒ¬ãƒ“è¦‹ã¦ã‚‹ã‚ˆãƒ¼", en: "I'm watching TV now." },
      { jp: "ã”ã‚ã‚“ã€é›»è©±ã‚‚ã‚‰ã£ãŸæ™‚å¯ã¦ãŸã®", en: "Sorry I was sleeping when you called me." },
      { jp: "ä»Šé€±æœ«ã€å‹é”ã«ä¼šã„ã«æ±äº¬ã«è¡Œãã®ãƒ¼", en: "I'm going to go to Tokyo this weekend to see my friend." },
      { jp: "æ¯å­ãŒå‹é”ã«ä¼šã„ã«ã‚«ãƒŠãƒ€ã«è¡Œãã®ã‚ˆ", en: "My son is going to go to Canada to see his friend." },
      { jp: "å½¼ã¨ã¯æ°—è»½ã«è©±ã›ã‚‹ã®", en: "I can talk to him about anything." },
      { jp: "ã™ã”ã„ãƒ‰ã‚­ãƒ‰ã‚­ã™ã‚‹ãƒ¼", en: "Iâ€™m excited." },
      { jp: "æ˜¨æ—¥ã€å¸°ã‚Šé“ã«ã„ã„ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³è¦‹ã¤ã‘ãŸã®", en: "I found a nice restaurant on the way home yesterday." },
      { jp: "æ˜¨æ—¥ã¯ä»•äº‹ã§å¿™ã—ã‹ã£ãŸã®", en: "I was busy with work yesterday." },
      { jp: "ã”ã‚ã‚“ã€æ˜æ—¥ï¼ˆãã“ã«ï¼‰ã„ã‘ãªã„ã‹ã‚‚", en: "Sorry I might not be able to go there tomorrow." },
      { jp: "æ˜¨æ—¥ã‚ˆãå¯ã‚Œãªã‹ã£ãŸã®ã‚ˆã­ã€œ", en: "I couldn't sleep well yesterday." },
      { jp: "ä»Šæ—¥æœã”ã¯ã‚“é£Ÿã¹ãªã‹ã£ãŸã®ã‚ˆã­", en: "I didn't eat breakfast today." },
      { jp: "ãƒãƒ¯ã‚¤è¡Œã£ãŸã®ã™ã”ã„å‰ã ã‹ã‚‰ä½•ã—ãŸã‹è¦šãˆã¦ãªã„ã‚„", en: "I don't remember what I did in Hawaii because I went there a long time ago." },
      { jp:"ãã®å…¬åœ’ã„ãã®ä¹…ã—ã¶ã‚Šãƒ¼", en:"Itâ€™s been a while since I last went to the park."},
      { jp:"ã“ã®é´ä¸‹ã€æ„å¤–ã¨é«˜ã‹ã£ãŸã®", en:"These socks were more expensive than I thought."},
      { jp:"ä»Šæ—¥ã€æ˜¨æ—¥ã‚ˆã‚Šæš‘ã„ã­", en:"It's hotter today than yesterday."},
      { jp:"è‹±èªå­¦ã³ã«ã‚«ãƒŠãƒ€ã«1å¹´é–“è¡Œã£ãŸã®", en:"I went to Canada for one year to learn English."},
      { jp:"ãªã‚“ã‹é£²ã¿ç‰©ã‚ã‚‹ï¼Ÿ", en:"Do you have something to drink?"},
      { jp:"ç”·ã®å­è‚²ã¦ã‚‹ã£ã¦äºˆæƒ³ä»¥ä¸Šã«å¤§å¤‰ã ã‚", en:"Raising a boy is harder than I thought."},
      { jp:"æ˜ ç”»è¦³ã‚‹ã®ã‚‚é£½ãã¦ããŸãªãã€œ", en:"I'm getting bored of watching movies."},
      { jp:"1ãƒ¶æœˆçµŒãŸãªã„ã¨å¤–ã«å‡ºã‚‰ã‚Œãªã„ã®", en:"I can't go outside for a month."},
      { jp:"è‹±èªã¯6å¹´ãã‚‰ã„ã‚„ã£ã¦ã‚‹ã‹ãªãã€œ", en:"I have been studying English for about 6 years."},
      { jp:"ãƒ¨ã‚¬ã¯ã©ã®ãã‚‰ã„ã‚„ã£ã¦ã‚‹ã®ï¼Ÿ", en:"How long have you been doing Yoga?"},
      { jp:"æ˜¨æ—¥è²·ã£ãŸã‚¤ãƒ¤ãƒ›ãƒ³ã€ãªãã—ã¡ã‚ƒã£ãŸ", en:"I lost the earphones that I bought yesterday."},
      { jp:"ã“ãªã„ã å—ã‘ãŸãƒ†ã‚¹ãƒˆã¯ã©ã†ã ã£ãŸï¼Ÿ", en:"How was the test that you took the other day?"},
      { jp:"ã„ã¤ã‚‚ä½•æ™‚ã«èµ·ãã‚‹ã®ï¼Ÿ", en:"What time do you always wake up?"},
      { jp:"è‹±èªã¯ã„ã¤å§‹ã‚ãŸã®ï¼Ÿ", en:"When did you start studying English?"},
      { jp:"è²·ã„ç‰©ã„ãã®ã‚ã‚“ã©ãã•ã„ãƒ¼", en:"I donâ€™t want to go shopping."},
      { jp:"å½¼å¥³ã€ãªã‚“ã§è»Šè²·ã£ãŸã®ï¼Ÿ", en:"Why did she buy a car?"},
      { jp:"ã‚‚ã—æ™‚é–“ã‚ã£ãŸã‚‰ä»Šæ—¥é›»è©±ã™ã‚‹ã­", en:"I'll call you if I have time today."},
      { jp:"ã‚‚ã—ã©ã“ã®å›½ã§ã‚‚ä½ã‚ã‚‹ã‚“ã ã£ãŸã‚‰ã©ã“ä½ã‚€ï¼Ÿ", en:"If you could live in any country, where would you live?"},
      { jp:"ãã®æ›²ã€æ¥æœˆãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã‚‰ã—ã„ã‚ˆã€œ", en:"I heard the song is going to be released next month."},
      { jp:"ãŠçš¿æ´—ã„ã‚’ã™ã‚‹ã‚ˆã†ã«è¨€ã‚ã‚ŒãŸã®", en:"I was told to do dishes."},
      { jp:"ã„ã‚ã‚“ãªäººã®è€ƒãˆã‚’çŸ¥ã‚‹ã®ãŒå¥½ããªã®", en:"I like talking to people because I get to know different ways of thinking."},
      { jp:"æ¯å­ãŒå‹•ç‰©åœ’ã«è¡ŒããŸã„ã£ã¦ã„ã£ã¦ãŸã®", en:"He said he wants to go to a zoo."},
      { jp:"å½¼å¥³ã€ä»•äº‹ã‚„ã‚ãŸã£ã¦ã„ã£ã¦ãŸã‚ˆ", en:"She said she quit her job."},
      { jp:"ã†ã¡ã®è¿‘ãã«ãƒ‘ãƒ³å±‹ãŒã‚ã‚‹ã‚“ã ã‘ã©ã€œ", en:"There is a bakery near my house."},
      { jp:"ã“ã“ã«æ–°ã—ã„ãƒ‘ãƒ³å±‹ãŒã§ãã‚‹ã¿ãŸã„ã‚ˆã‰ã€œ", en:"There is going to be a new bakery here."},
      { jp:"å­ä¾›ãŒå®¶ã«ã„ã‚‹ã¨ãªã‹ãªã‹è‡ªåˆ†ã®æ™‚é–“ãŒä½œã‚Œãªãã¦", en:"It's not easy to make my own time when my kid is at home."},
      { jp:"å­ä¾›ã¨è‹±èªå­¦ã¶ã®æ¥½ã—ã„ã‚ˆã£", en:"It's fun to study English with kids."},
      { jp:"1æœˆã¯ç¹å¿™æœŸã§å¿™ã—ã„ã®", en:"Iâ€™m busy in January every year."},
      { jp:"ä»Šæ—¥ä½•æ™‚ã«å®¶å¸°ã‚Œã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã‚", en:"I don't know what time I can get back home today."},
      { jp:"å½¼ä½•æ­³ã‹ã¯ã‚ã‹ã‚‰ãªã„ã‚ã€‚", en:"I don't know how old he is."},
      { jp:"ä»Šæ—¥å¤œ8æ™‚ã¾ã§ã«å¸°ã‚Œã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã‚", en:"I don't know If I can get back home by 8 today."},
      { jp:"æ™‚é–“é€šã‚Šã«ãã®é›»è»Šä¹—ã‚Œã‚‹ã‹ãªã", en:"I don't know If I can get on the train on time."},
      { jp:"å½¼å¥³ãŒè¨€ã£ãŸã“ã¨å…¨ç„¶ç†è§£ã§ããªã‹ã£ãŸã‚", en:"I couldn't understand what she said at all."},
      { jp:"ã“ã‚Œç§ãŒæ¬²ã—ã‹ã£ãŸã‚„ã¤", en:"This is what I wanted."},
      { jp:"å®¶ã§ã®ã‚“ã³ã‚Šã—ãŸã„ãªãã€œ", en:"I want to relax at home."},
      { jp:"ä½•ã‹é£Ÿã¹ãŸå¾Œã£ã¦ã„ã¤ã‚‚çœ ããªã‚‹ã®ã‚ˆã­ã€œ", en:"I always get sleepy after I eat something."},
      { jp:"æ˜¨æ—¥å…¨ç„¶å¯ã‚Œãªãã¦ä»Šè¶…çœ ã„ã®", en:"I'm so sleepy now because I couldn't sleep at all yesterday."},
      { jp:"æ¯å­ã¯æµ·å¤–1äººã§è¡Œãã«ã¯ã¾ã æ—©ã„ã‚ã­", en:"My son is too young to go abroad alone."},
      { jp:"ã“ã®ç®±ã€é‡ã™ãã¦æŒã¡ä¸ŠãŒã‚“ãªã„ã‚„", en:"This box is too heavy to lift."},
      { jp:"è²·ã„ç‰©è¡Œãæš‡ãªã„ã‚", en:"I don't have enough time to go shopping."},
      { jp:"ä»Šæ—¥å‹‰å¼·ã™ã‚‹æ™‚é–“ãªã„ã‚", en:"I don't have enough time to study today."},
      { jp:"æœèµ·ãã‚‹æ™‚é–“ã¯æ±ºã¾ã£ã¦ãªã„ã­ã‡", en:"I donâ€™t wake up at the same time everyday."},
      { jp:"æ¯å­ã«ã¯è‹±èªè©±ã›ã‚‹ã‚ˆã†ã«ãªã£ã¦ã»ã—ã„ã‚", en:"I want my son to be able to speak English."},
      { jp:"æ¥é€±è²·ã„ç‰©ã§ã‚‚è¡Œã‹ãªã„ï¼Ÿ", en:"Do you want to go shopping next week?"},
      { jp:"ã”ã‚ã‚“ã€æ˜¨æ—¥ç—…é™¢è¡Œã‹ãªã„ã¨ã„ã‘ãªã‹ã£ãŸã®", en:"Sorry I had to go see a doctor yesterday."},
      { jp:"å…¨ç„¶ãŠè…¹ç©ºã„ã¦ãªã„ã‚", en:"I'm not hungry at all."},
      { jp:"æ´—æ¿¯å…¥ã‚Œã¦ã‚‚ã‚‰ã£ã¦ã„ã„ï¼Ÿ", en:"Can you take in the laundry?"},
      { jp:"5æ­³ã®æ™‚ã‹ã‚‰ãƒ”ã‚¢ãƒå¼¾ã„ã¦ã‚‹ã®", en:"I've been playing the piano since I was 5."},
      { jp:"è‡ªåˆ†ã®è¨€ã„ãŸã„ã“ã¨ãŒè¨€ãˆãªã„ã®", en:"I can't say what I want to say."},
      { jp:"å¨˜ã«ã¯å°†æ¥ï¼ˆäººç”Ÿã«ãŠã„ã¦ï¼‰ã„ã‚ã‚“ãªé¸æŠè‚¢ã‚’æŒã£ã¦æ¬²ã—ã„ã®", en:"I want my daughter to have a lot of options of life."},
      { jp:"æ˜æ—¥ãªã‚‰å…¬åœ’è¡Œã‘ã‚‹ã‹ã‚‚", en:"I might be able to go to the park tomorrow."},
      { jp:"å½¼ãŒè¨€ã£ã¦ãŸã“ã¨ã€å…¨ãç†è§£ã§ããªã‹ã£ãŸã‚", en:"I couldn't understand what he was saying at all."},
      { jp:"ã‚´ãƒŸå‡ºã—ã¦ã‚‚ã‚‰ã£ã¦ã„ã„ï¼Ÿ", en:"Can you take out the trash?"},
      { jp:"ãã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã¯æœ9æ™‚ã‹ã‚‰å¤œ8æ™‚ã¾ã§é–‹ã„ã¦ã‚‹ã‚ã‚ˆ", en:"The supermarket is open from 9am to 8pm."},
      { jp:"å½¼ã€çµå©šã—ãŸã‚‰ã—ã„ã‚ˆã€œ", en:"I heard he got married."},
      { jp:"å­è‚²ã¦ãŒè½ã¡ç€ã„ãŸã‚‰ä¸€äººã§ãƒãƒ¯ã‚¤ã«è¡ŒããŸã„ãªãƒ¼", en:"I want to go to Hawaii alone when my kids grow up and I have more time."},
      { jp:"ãã®ãƒ†ã‚¹ãƒˆã€æ„å¤–ã«é›£ã—ã‹ã£ãŸã®", en:"The test was more difficult than I thought."}

    ];

    let usedIndexes = [];
    let currentIndex = 0;
    let answersLog = [];
    let currentQuestionNumber = 0;

    const progressEl = document.getElementById('progress');
    const questionEl = document.getElementById('question');
    const answerEl = document.getElementById('answer');
    const feedbackEl = document.getElementById('feedback');
    const resultEl = document.getElementById('result');
    const submitBtn = document.getElementById('submit');
    const nextBtn = document.getElementById('next');

    function getRandomQuestion() {
      if (usedIndexes.length >= 20) return null;
      let index;
      do {
        index = Math.floor(Math.random() * questionsData.length);
      } while (usedIndexes.includes(index));
      usedIndexes.push(index);
      return questionsData[index];
    }

    function showQuestion() {
      const q = getRandomQuestion();
      if (!q) {
        endQuiz();
        return;
      }
      currentIndex = questionsData.indexOf(q);
      currentQuestionNumber = usedIndexes.length;
      progressEl.textContent = `ç¬¬${currentQuestionNumber}å• / å…¨20å•`;
      questionEl.textContent = q.jp;
      feedbackEl.textContent = '';
      answerEl.value = '';
      answerEl.style.display = 'block';
      submitBtn.style.display = 'inline-block';
      nextBtn.style.display = 'none';
    }


    const synonyms = {
  // ğŸ”¹å‹•è©ï¼ˆVerbï¼‰
  "buy": ["get", "purchase", "pick up"],
  "get": ["buy", "obtain", "receive"],
  "say": ["tell", "mention"],
  "tell": ["say", "inform"],
  "speak": ["talk", "chat"],
  "talk": ["speak", "chat"],
  "begin": ["start"],
  "start": ["begin"],
  "make": ["create", "build", "cook", "prepare"],
  "cook": ["make", "prepare"],
  "eat": ["have"],
  "drink": ["have"],
  "see": ["watch", "look at"],
  "watch": ["see", "look at"],
  "look for": ["search for", "try to find"],
  "find": ["discover"],
  "help": ["assist", "support", "give a hand"],
  "fix": ["repair", "mend"],
  "go": ["travel", "move"],
  "come": ["arrive"],
  "leave": ["go out", "depart"],
  "meet": ["see", "get together with"],
  "live": ["stay", "reside"],
  "need": ["require"],
  "want": ["would like", "hope to"],
  "think": ["believe", "guess", "suppose"],
  "wait": ["hang on", "hold on"],
  "try": ["attempt"],
  "use": ["utilize"],
  "show": ["display"],
  "finish": ["end", "complete"],
  "understand": ["get", "figure out"],
  "ask": ["request", "inquire"],
  "learn": ["study", "pick up"],
  "teach": ["instruct"],
  "remember": ["recall"],
  "forget": ["miss", "fail to remember"],
  "give": ["hand", "offer", "pass"],
  "take": ["grab", "carry"],
  "like": ["enjoy", "love"],
  "love": ["like", "enjoy"],
  "hate": ["dislike", "canâ€™t stand"],
  "work": ["labor", "do a job"],
  "rest": ["relax", "take a break"],
  "walk": ["go on foot", "stroll"],
  "run": ["jog"],
  "open": ["unlock"],
  "close": ["shut"],
  "say sorry": ["apologize"],

  // ğŸ”¹åè©ï¼ˆNounï¼‰
  "children": ["kids"],
  "child": ["kid"],
  "friend": ["buddy", "pal", "mate"],
  "job": ["work", "occupation"],
  "house": ["home", "residence"],
  "car": ["vehicle", "ride"],
  "clothes": ["outfit", "garment"],
  "money": ["cash"],
  "picture": ["photo", "image"],
  "question": ["inquiry"],
  "answer": ["reply", "response"],
  "food": ["meal", "dish"],
  "movie": ["film"],
  "store": ["shop"],
  "teacher": ["instructor"],
  "student": ["learner"],
  "street": ["road"],
  "school": ["academy"],
  "book": ["novel", "volume"],

  // ğŸ”¹å½¢å®¹è©ï¼ˆAdjectiveï¼‰
  "happy": ["glad", "pleased"],
  "sad": ["unhappy", "upset"],
  "angry": ["mad"],
  "beautiful": ["pretty", "lovely", "gorgeous"],
  "difficult": ["hard"],
  "easy": ["simple"],
  "fast": ["quick"],
  "slow": ["sluggish"],
  "tired": ["sleepy", "exhausted"],
  "hungry": ["starving"],
  "full": ["stuffed"],
  "good": ["nice", "great", "fine"],
  "bad": ["terrible", "awful"],
  "okay": ["fine", "alright"],
  "big": ["large", "huge"],
  "small": ["little", "tiny"],
  "rich": ["wealthy"],
  "poor": ["needy"],
  "busy": ["occupied"],
  "funny": ["amusing", "hilarious"],
  "interesting": ["fascinating"],
  "important": ["significant", "crucial"],
  "smart": ["clever", "intelligent"],
  "beautiful": ["pretty", "lovely", "cute"],
  "cold": ["chilly", "cool"],
  "hot": ["warm", "boiling"],
  "scary": ["frightening", "creepy"],
  "friendly": ["kind", "nice"],
  "expensive": ["costly", "pricey"],
  "cheap": ["inexpensive"],

  // ğŸ”¹å‰¯è©ãƒ»è¡¨ç¾ï¼ˆAdverb / Phrasesï¼‰
  "maybe": ["perhaps", "possibly"],
  "really": ["very", "truly"],
  "a lot": ["lots", "plenty"],
  "right now": ["currently", "at the moment"],
  "later": ["afterwards", "soon"],
  "sometimes": ["occasionally"],
  "always": ["all the time"],
  "never": ["not ever"],
  "very good": ["great", "awesome"],
  "very bad": ["terrible", "awful"],
  "thank you": ["thanks", "appreciate it"],
  "goodbye": ["bye", "see you"],
  "hello": ["hi", "hey"]
};


  function checkAnswer() {
  const userAnswer = answerEl.value.trim();
  const correctAnswer = questionsData[currentIndex].en;

  // ğŸ”½ å‰å‡¦ç†ï¼ˆå°æ–‡å­—åŒ–ï¼‹ç¸®ç´„å½¢çµ±ä¸€ï¼‰
  const normalize = str =>
    str
      .toLowerCase()
      .replace(/â€™/g, "'")
      // notç³»
      .replace(/\bshouldn['â€™]t\b/g, "should not")
      .replace(/\bcouldn['â€™]t\b/g, "could not")
      .replace(/\bwouldn['â€™]t\b/g, "would not")
      .replace(/\bdon['â€™]t\b/g, "do not")
      .replace(/\bdoesn['â€™]t\b/g, "does not")
      .replace(/\bdidn['â€™]t\b/g, "did not")
      // haveç³»ï¼ˆ'veï¼‰
      .replace(/\bshould['â€™]ve\b/g, "should have")
      .replace(/\bcould['â€™]ve\b/g, "could have")
      .replace(/\bwould['â€™]ve\b/g, "would have")
      
       // å¦å®šå½¢
        .replace(/\bshouldn['â€™]t\b/g, "should not")
        .replace(/\bcouldn['â€™]t\b/g, "could not")
        .replace(/\bwouldn['â€™]t\b/g, "would not")
        .replace(/\bdon['â€™]t\b/g, "do not")
        .replace(/\bdoesn['â€™]t\b/g, "does not")
        .replace(/\bdidn['â€™]t\b/g, "did not")
        .replace(/\bwasn['â€™]t\b/g, "was not")
        .replace(/\bweren['â€™]t\b/g, "were not")
        .replace(/\bisn['â€™]t\b/g, "is not")
        .replace(/\baren['â€™]t\b/g, "are not")
        .replace(/\bhasn['â€™]t\b/g, "has not")
        .replace(/\bhaven['â€™]t\b/g, "have not")
        .replace(/\bhadn['â€™]t\b/g, "had not")

        // beå‹•è©ç³»
        .replace(/\bi['â€™]m\b/g, "i am")
        .replace(/\byou['â€™]re\b/g, "you are")
        .replace(/\bhe['â€™]s\b/g, "he is")
        .replace(/\bshe['â€™]s\b/g, "she is")
        .replace(/\bit['â€™]s\b/g, "it is")
        .replace(/\bwe['â€™]re\b/g, "we are")
        .replace(/\bthey['â€™]re\b/g, "they are")

        // have/has/had ç³»
        .replace(/\bi['â€™]ve\b/g, "i have")
        .replace(/\byou['â€™]ve\b/g, "you have")
        .replace(/\bwe['â€™]ve\b/g, "we have")
        .replace(/\bthey['â€™]ve\b/g, "they have")
        .replace(/\bhe['â€™]s\b/g, "he has")
        .replace(/\bshe['â€™]s\b/g, "she has")
        .replace(/\bit['â€™]s\b/g, "it has")

        // had ç³»
        .replace(/\bi['â€™]d\b/g, "i had")
        .replace(/\byou['â€™]d\b/g, "you had")
        .replace(/\bhe['â€™]d\b/g, "he had")
        .replace(/\bshe['â€™]d\b/g, "she had")
        .replace(/\bwe['â€™]d\b/g, "we had")
        .replace(/\bthey['â€™]d\b/g, "they had")

        // will ç³»
        .replace(/\bi['â€™]ll\b/g, "i will")
        .replace(/\byou['â€™]ll\b/g, "you will")
        .replace(/\bhe['â€™]ll\b/g, "he will")
        .replace(/\bshe['â€™]ll\b/g, "she will")
        .replace(/\bit['â€™]ll\b/g, "it will")
        .replace(/\bwe['â€™]ll\b/g, "we will")
        .replace(/\bthey['â€™]ll\b/g, "they will")

      .trim()
      .replace(/\s+/g, " "); // ä½™åˆ†ãªç©ºç™½ã‚’çµ±ä¸€

  const normalizedUser = normalize(userAnswer);
  const normalizedCorrect = normalize(correctAnswer);

  // ğŸš« æ˜ç¢ºãªæ–‡æ³•ãƒŸã‚¹ï¼ˆto there, to home ãªã©ï¼‰
  const grammarErrors = [/to there\b/, /to home\b/, /to abroad\b/, /to outside\b/];
  const hasGrammarError = grammarErrors.some(re => re.test(normalizedUser));

  // ğŸ§  å˜èªãƒ¬ãƒ™ãƒ«ã§æ„å‘³ã®ä¸€è‡´ã‚’ãƒã‚§ãƒƒã‚¯
  const userWords = normalizedUser.split(" ");
  const correctWords = normalizedCorrect.split(" ");

  // åŒç¾©èªè¾æ›¸ï¼ˆå¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µå¯èƒ½ï¼‰
  const synonyms = {
    "children": ["kids"],
    "buy": ["purchase", "get"],
    "begin": ["start"],
    "want": ["would like"],
    "help": ["assist"],
    "ask": ["request"]
  };

  // åŒç¾©èªã‚’è€ƒæ…®ã—ã¦ãƒãƒƒãƒåˆ¤å®š
  const matchedCount = correctWords.filter(correctWord => {
    return userWords.some(userWord => {
      if (userWord === correctWord) return true;
      const syns = synonyms[correctWord];
      return syns ? syns.includes(userWord) : false;
    });
  }).length;

  const similarity = matchedCount / correctWords.length;

  // âœ… æ„å‘³ã¨æ–‡æ³•ã®ä¸¡æ–¹ãŒåˆã£ã¦ã„ã‚Œã°æ­£è§£
  const isCorrect =
    !hasGrammarError &&
    (normalizedUser === normalizedCorrect || similarity >= 0.8);

  if (isCorrect) {
    feedbackEl.innerHTML = `âœ… æ­£è§£ã§ã™ï¼<br>æ¨¡ç¯„è§£ç­”ï¼š<span style="color:#0078d7;">${correctAnswer}</span>`;
    feedbackEl.style.color = "green";
  } else {
    feedbackEl.innerHTML = `âŒ ä¸æ­£è§£ã§ã™ã€‚<br>ã‚ãªãŸã®å›ç­”ï¼š<span style="color:#555;">${userAnswer}</span><br>æ¨¡ç¯„è§£ç­”ï¼š<span style="color:#d32f2f;">${correctAnswer}</span>`;
    feedbackEl.style.color = "red";
  }

  answersLog.push({
    jp: questionsData[currentIndex].jp,
    user: userAnswer,
    correct: correctAnswer,
    result: isCorrect ? "æ­£è§£" : "ä¸æ­£è§£"
  });

  submitBtn.style.display = "none";
  nextBtn.style.display = "inline-block";
}



   

    function endQuiz() {
      
      const totalCorrect = answersLog.filter(a => a.result === "æ­£è§£").length;
      

      questionEl.textContent = 'ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼å…¨20å•ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚';
      progressEl.textContent = '';
      answerEl.style.display = 'none';
      submitBtn.style.display = 'none';
      nextBtn.style.display = 'none';
      feedbackEl.textContent = '';

      let tableHTML = `<p style="font-size:1.2em; font-weight:bold;">çµæœï¼š20å•ä¸­ ${totalCorrect}å•æ­£è§£ï¼</p>`;
      
      tableHTML += '<table><tr><th>å‡ºé¡Œæ–‡ï¼ˆæ—¥æœ¬èªï¼‰</th><th>ã‚ãªãŸã®è§£ç­”</th><th>æ­£è§£è‹±æ–‡</th><th>çµæœ</th></tr>';

      answersLog.forEach(a => {
        const mark = a.result === "æ­£è§£" ? "ğŸŸ¢" : "âŒ";
        tableHTML += `<tr>
          <td>${a.jp}</td>
          <td>${a.user}</td>
          <td>${a.correct}</td>
          <td class="mark">${mark}</td>
        </tr>`;
      });
      tableHTML += '</table>';
      resultEl.innerHTML = tableHTML;

      const retryBtn = document.createElement('button');
      retryBtn.textContent = "ã‚‚ã†ä¸€åº¦ã™ã‚‹";
      retryBtn.style.marginTop = "15px";
      retryBtn.onclick = resetQuiz;
      resultEl.appendChild(retryBtn);
    }


    function resetQuiz() {
  usedIndexes = [];
  answersLog = [];
  currentIndex = 0;
  currentQuestionNumber = 0;

  // UIã‚’å…ƒã«æˆ»ã™
  answerEl.style.display = 'block';
  submitBtn.style.display = 'inline-block';
  feedbackEl.textContent = '';
  resultEl.innerHTML = '';

  showQuestion();
}


    submitBtn.addEventListener('click', checkAnswer);
    nextBtn.addEventListener('click', () => {
      if (usedIndexes.length >= 20) {
        endQuiz();
      } else {
        showQuestion();
      }
    });

    showQuestion();
  </script>
</body>
</html>